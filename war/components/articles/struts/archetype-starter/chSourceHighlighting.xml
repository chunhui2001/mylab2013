<?xml version="1.0" encoding="utf-8"?>
<c:component type="chSourceHighlighting" componentId="chSourceHighlighting_1" xmlns:c="http://com.snnmo.website">

  <c:abstract>
    <![CDATA[]]>
  </c:abstract>

  <c:entry>
    <c:title>生成 struts2-archetype-starter 启动器项目</c:title>
    <c:desc>
      <c:desc1> <![CDATA[通过该启动器创建的项目包含所有基本元素以及大多数 Web 应用将要使用到的公共 Struts2 插件]]></c:desc1>
    </c:desc>

    <c:sourceContent type="" title=""
                     id="sourceContent1"><![CDATA[mvn archetype:generate -B  
    -DgroupId=com.test.mysite 
    -DartifactId=mysite 
    -DarchetypeGroupId=org.apache.struts 
    -DarchetypeArtifactId=struts2-archetype-starter

// 运行 Servlet 容器 (需进入 pom.xml 文件所在目录)
mvn -Djetty.port=9999 jetty:run]]></c:sourceContent>

    <c:sourceContent type="html" title="目录结构"
                     id="sourceContent1">
      <![CDATA[
      <div>
<img src="http://farm4.staticflickr.com/3679/13261559325_59723e80dc_b.jpg" 
      style="border:solid 1px gray;float:left;margin-right:1em;
            border-top-right-radius:8px;
            border-top-left-radius:8px;
            border-bottom-right-radius:8px;
            border-bottom-left-radius:8px;" alt="" />
<div>
  <span><span style="font-weight:bold;color:red;">src 目录</span> 是所有代码的根目录，在该目录下包含 main 目录和 test 目录，只有在 src 目录下的内容才会被打包到最终软件制品中去。</span><br />
  <span><span style="font-weight:bold;color:red;">resource 目录</span> 包含属性、XML、配置文件</span><br />
  <span><span style="font-weight:bold;color:red;">aspects 目录</span> 当 AspectJ 插件被包含进来时，会出现该目录</span><br />
  <span><span style="font-weight:bold;color:red;">groovy 目录</span> 包含 Groovy 脚本以备执行 (<a target="_blank" href="http://groovy.codehaus.org/Chinese+Home">Groovy</a> 是一种动态脚本语言，语法和 Java 很相似，可以直接执行也可以向下编译成字节码。) </span><br />  
  <span><span style="font-weight:bold;color:red;">webapp 目录</span> 对于打包成 war 文件的软件制品，该目录包含 WAR 文件所需的其它信息，而 EAR 或 JAR 不需要这些信息</span><br />
</div>
<div class="clear"></div>
</div>
]]>
    </c:sourceContent>

    <c:sourceContent type="" title="Maven2 配置文件"
                     id="sourceContent1"><![CDATA[<project>      
    <!-- modelVersion 该值表示 Maven2 的模型版本 -->
    <modelVersion>4.0.0</modelVersion> 
    
    <groupId>com.mytest.webapp</groupId>
    <artifactId>webapp</artifactId>
    
    <!-- 如果是 web 项目，那么该值总是 war (也可以是 jar) -->
    <!-- 如果项目中是一个包含了 Web 组件、EJB 组件或其它资源的 J2EE 应用，那么 packaging 的值就是 ear -->
    <packaging>war</packaging>       
    
    <!-- version 的值可以保持不变。当组件作为产品发布时，version 的值需改成 1.0，随之进一步的开发可以做相应递增。 -->
    <version>1.0-SNAPSHOT</version>
    
    <!-- 在启动器应用的代码生成之后可以修改 name、url、description 的默认值，这三个元素用来描述开发者和使用者的信息 -->
    <name>Struts 2 Starter</name>
    <url>http://www.myComp.com</url>
    <description>Struts 2 Starter</description>
    .........
</project>]]></c:sourceContent>

    <c:sourceContent type="" title="依赖项的配置"
                     id="sourceContent1"><![CDATA[<project>      
    .........
    <dependencies>
        <!-- jUnit -->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>3.8.1</version>
            <scope>test</scope>
        </dependency>
        
        <!-- Struts2 -->
        <dependency>
            <groupId>org.apache.struts</groupId>
            <artifactId>struts2-core</artifactId>
            <version>2.0.9</version>
        </dependency>
        
        <!-- Servlet & Jsp -->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
            <version>2.4</version>
            <scope>provided</scope>
        </dependency>
        ........
    </dependencies>
    .........
</project>]]></c:sourceContent>

    <c:sourceContent type="" title="控制构建过程&#8212;build"
                     id="sourceContent1"><![CDATA[<project>      
    .........
    <build>
        <!-- finalName 用于覆盖最终产品名字: myapp.war (设置), myapp-1.0-SNAPSHOT.war(不设置) -->
        <finalName>myapp</finalName> 
        <plugins>
            <plugin>
                 <artifactId>maven-compiler-plugin</artifactId>   <!-- Java5 编译器 -->
                 <configuration>
                    <source>1.5</source>
                    <target>1.5</target>
                 </configuration>
            </plugin>
            <plugin>
                <groupId>org.mortbay.jetty</groupId>              <!-- Servlet 容器 -->
                <artifactId>maven-jetty-plugin</artifactId>
                <version>6.0.1</version>
                <configuration>
                    <!-- 默认 8080 端口 -->
                     
                    <!-- 告诉 Jetty 10 秒钟检查一次 war 文件，一旦发生变化就重新加载应用 -->
                    <scanIntervalSeconds>10</scanIntervalSeconds>
                </configuration>
            </plugin>
        </plugins>
    </build>
    .........
</project>]]></c:sourceContent>

    <c:sourceContent type="" title="struts2-archetype-starter 启动器包含的插件"
                     id="sourceContent1"><![CDATA[<project>      
    .........
    <dependencies>
        <!-- sitemesh -->
        <dependency>
            <!-- sitemesh 提供一套初始用户界面 -->
            <!-- sitemesh 利用过滤器拦截 Struts2 结果然后往结果里增加其他 HTML 代码 -->
            <!-- 启动器生成的 WEB-INF/decorators.xml 文件中给出了 URL 模式与装饰器之间的映射信息 -->
            <!-- WEB-INF/decorators/main.jsp 中定义了 3 个非常有用的标签: <decorator:title />，<decorator:head />，<decorator:body /> -->
            <!-- <decorator:title /> 将原始页面的 title 插入装饰器模板 -->
            <!-- <decorator:head /> 将原始页面的 head 标签里的内容插入装饰器模板 -->
            <!-- <decorator:body /> 将原始页面的 body 标签里的内容插入装饰器模板 -->
            <!-- 原始页面并不需要引用装时器模板文件，这是一种松耦合的可选机制 -->
            <groupId>org.apache.struts</groupId>
            <artifactId>struts2-sitemesh-plugin</artifactId>
            <version>2.0.9</version>
        </dependency>
        
        <!-- spring -->
        <dependency>
            <groupId>org.apache.struts</groupId>
            <artifactId>struts2-spring-plugin</artifactId>
            <version>2.0.9</version>
        </dependency>
    </dependencies>
    .........
</project>

<!-- 修改 web.xml 配置文件，使插件工作 --> 
<context-param>
    <!-- 指定 applicationContext.xml 配置文件的存放位置 -->
    <param-name>contextConfigLocation</param-name>
    <param-value>classpath*:applicationContext*.xml</param-value>
</context-param>

<listener>
    <!-- 该监听器用于访问 spring 上下文 -->
    <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
</listener>


<!-- 为 sitemesh 定义过滤器 -->
<filter>
    <filter-name>action2-cleanup</filter-name>
    <filter-class>org.apache.struts2.dispather.ActionContextCleanUp</filter-class>
</filter>
<filter>
    <filter-name>sitemesh</filter-name>
    <filter-class>com.opensymphony.module.sitemesh.filter.PageFilter</filter-class>
</filter>
<filter>
    <filter-name>action2</filter-name>
    <filter-class>org.apache.struts2.dispather.FilterDispather</filter-class>
</filter>

<filter-mapping>
    <filter-name>action2-cleanup</filter-name>
    <filter-class>/*</filter-class>
</filter-mapping>
<filter-mapping>
    <filter-name>sitemesh</filter-name>
    <filter-class>/*</filter-class>
</filter-mapping>
<filter-mapping>
    <filter-name>action2</filter-name>
    <filter-class>/*</filter-class>
</filter-mapping>]]></c:sourceContent>
    
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>
  
  <c:entry style="margin-top:2em;">
    <c:title>显示第一个页面 index.action</c:title>
    <c:desc>
      <c:desc1> <![CDATA[运行 servlet 容器, jetty:run --> http://localhost:8080/app --> http://localhost:8080/app/index.action ]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="IndexAction.java" style="border-bottom:none;"
                      id="sourceContent1"><![CDATA[@Conversion()
public class IndexAction extends ActionSupport {
    // Struts2 为每个请求创建一个新的 action 实例，所以实例中类的成员变量是每个请求独有的，因此可以使用该成员变量传递数据 (当然也可以使用方法中的局部变量)
    // Struts1.x 在多个请求中共享 action 实例，无法保证线程安全，因此只能使用方法中的局部变量
    private Date now = new Date(System.currentTimeMillis());
    
    @TypeConversion(converter = "com.fdar.apress.s2.DateConverter")
    public Date getDateNow() { 
        return this.now;        // 任何类属性都可以在获取方法和设置方法中使用
    }
          
    public String execute() {
        // 使用方法中的局部变量
        now = new Date(System.currentTimeMillis());
        return SUCCESS;
    }
}]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" style="border-top:none;"
                      id="sourceContent1"><![CDATA[<!-- src/main/resources/struts.xml -->
<struts>
    <package name="myPackage" extends="struts-default">
        <action name="index" class="com.mypackagename.IndexAction">
            <!-- 注意该 action 没有提供 namespace 属性 -->
            <!-- result 的 name 属性默认是 success，type 属性默认是 jsp -->
            <result>/jsp/index.jsp</result>
        </action>
    </package>
</struts>]]></c:sourceContent>
    
    <c:sourceContent type="" title="/jsp/index.jsp"
                      id="sourceContent1"><![CDATA[<%@taglib prefix="s" uri="/struts-tags" %>
      
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>Index</title>
        <s:head />
    </head>
    <body>
        <s:form action="helloWorld">
            <s:textfield name="name" label="What is your name?" />
            <s:textfield name="dateNow" label="What is the date?" />
                
            <s:submit />
        </s:form>
    </body>
</html>]]></c:sourceContent>
    <c:sourceContent type="" title="helloWorldAction.java" style="border-bottom:none;"
                      id="sourceContent1"><![CDATA[@Validation()      // 类级别注释告诉 Struts2 该类具有验证功能
@Conversion()
public class HelloWorldAction extends ActionSupport {
    private Date now;
    private String name;
    
    @TypeConversion (converter = "com.mypackage.DateConverter")
    @RequiredFieldValidator (message = "Please enter the date")
    public void setDateNow(Date now) {
        this.now = now;
    }
    
    public Date getDateNow() {
        return this.now;
    }
    
    @RequiredStringValidator (message = "Please enter a name", tirm = true)
    public void setName(String name) {
        this.name = name;
    }
    
    public String getName() {
        return this.name;
    }
    
    public String execute() thorws Exception {
        return SUCCESS;
    }
}]]></c:sourceContent>
    <c:sourceContent type="" title="" style="border-top:none;border-bottom:none;"
                      id="sourceContent1"><![CDATA[<!-- src/main/resources/struts.xml -->
<struts>
    <package name="myPackage" extends="struts-default">
        <!-- 让 Spring 管理 action 的创建，需将 class 属性设置成 spring bean 的 id -->
        <action name="helloWorld" class="helloWorldAction">
            <result name="input">/jsp/index.jsp</result>
            <result>/jsp/helloWrold.jsp</result>
        </action>
    </package>
</struts>]]></c:sourceContent>
    <c:sourceContent type="" title="" style="border-top:none;"
                      id="sourceContent1"><![CDATA[<!-- src/main/resources/applicationContext.xml -->
<beans>
    <bean id="helloWorldAction"
          class="com.mypackagename.HelloWorldAction" singleton="false" />
</beans>]]></c:sourceContent>

    <c:sourceContent type="" title="/jsp/helloWrold.jsp"
                  id="sourceContent1"><![CDATA[<%@taglib prefix="s" uri="/struts-tags" %>
      
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>Hello world!</title>
        <s:head />
    </head>
    <body>
        Hello <s:property name="name" />，today is <s:property name="dateNow" />
    </body>
</html>]]></c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>
  </c:component>