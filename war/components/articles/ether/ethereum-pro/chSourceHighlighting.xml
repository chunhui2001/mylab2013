<?xml version="1.0" encoding="utf-8"?>
<c:component type="chSourceHighlighting" componentId="chSourceHighlighting_1" xmlns:c="http://com.snnmo.website">
  <c:abstract style="font-size:1em;line-height:1.6em;">
    <![CDATA[
<div style="margin-bottom:1em;">作为一种比较新的利用<b style="color:red;">区块链技术</b>的开发项目，以太坊致力于实施全球<b style="color:red;">去中心化</b>且无所有权的的数字技术计算机来执行点对点合约。简单来说就是，以太坊是一个你无法关闭的世界计算机。以太坊通过一套图灵完备的脚本语言（Ethereum Virtual Machinecode，简称EVM语言）来建立应用，它类似于汇编语言。我们知道，直接用汇编语言编程是非常痛苦的，但以太坊里的编程并不需要直接使用EVM语言，而是类似C语言、Python、Lisp等高级语言，再通过编译器转成EVM语言。</div>

<div style="margin-bottom:1em;">以太坊可以构建许多不同类型的应用程序。今天，大多数应用程序分为以下几类：DeFi、DEX、游戏、收藏品、市场、供应链、开发工具、ID、治理、基础设施、企业以太坊、预言机。</div>

<div style="margin-bottom:1em;">
与比特币相比，以太坊最大的不同点是：允许开发者在上面开发任意应用，实现任意智能合约，这也是以太坊的最强大之处。作为平台，以太坊可以类比于苹果的应用商店，任何开发者都可以在上面开发应用，并出售给用户。
</div>

]]>
  </c:abstract>
  
  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">以太坊版本说明</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  为保持一致的源代码讲解环境，推荐在本地签出 git commit bca140 代码进行查看。命令如下：
</div>
<div>
首先，创建文件夹存放源代码：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.2em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
$ mkdir -p $GOPATH/src/github.com/ethereum/go-ethereum
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1.25em;">
      <![CDATA[
<div>
  再从 Github 下载以太坊 Go-ethereum 项目源代码：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.2em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
$ cd $GOPATH/src/github.com/ethereum/go-ethereum
$ git clone https://github.com/ethereum/go-ethereum.git  ./
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1.25em;">
      <![CDATA[
<div>
  下载成功后，利用 git commit 创建新分支 deepeth：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.2em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
$ git checkout -b deepeth bca140
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1.25em;">
      <![CDATA[
<div>
  当你切换分支成功后，看到命令行最后一行信息应该是：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:gray;font-size:1em;background-color:white;"
                     bodyStyle="background-color:white;padding:0;font-size:1.2em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
Switched to a new branch 'deepeth'
   ]]>
    </c:sourceContent>
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>



  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">编译geth</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="font-size:1.2em;">
  为降低沟通成本，请在本机准备好随时可使用的 geth 可执行程序。
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="1. 打开 go-ethereum 目录" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.1em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ cd $GOPATH/src/github.com/ethereum/go-ethereum
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="2. 编译 go-ethereum" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.1em;background-color:white;margin-top:.625em;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ make
# output:
#   Done building.
#   Run: "$GOPATH/src/github.com/ethereum/go-ethereum/build/bin/geth" to launch geth.
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="3. 拷贝可执行程序" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.1em;background-color:white;margin-top:.625em;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
# Go 开发中，一般环境变量 $GOPATH 均有设置，且 $GOPATH/bin 目录也会加入环境变量，方便命令行直接执行可执行程序。 
# 因此 geth 执行程序也重命名为 dgeth 存放至此。
$ mv $GOPATH/src/github.com/ethereum/go-ethereum/build/bin/geth $GOPATH/bin/dgeth
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="4. 检查文件" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.1em;background-color:white;margin-top:.625em;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1.1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ dgeth version
# output:
#   Geth
#   Version: 1.9.0-unstable
#   Git Commit: bca140b73dc107676c912d87f6fe9c352d5fd0d8
   ]]>
    </c:sourceContent>
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>


  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">以太坊术语</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="专有名词" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;"><b>外部账户</b>: EOAs（External Owned Accounts），关联个人掌握的私钥。可以用于发送交易（转移以太币或发送消息），形同一张带数字ID的储蓄卡。</li>
  <li style="margin-top:.3em;"><b>合约账户</b>: Contracts Accounts，可以在以太坊上存储合约代码与合约数据的账户，外部不能直接操作此账户。只能由外部账户直接或间接调用。</li>
  <li style="margin-top:.3em;"><b>账户状态</b>: account state，表示一个账户在以太坊中的状态。账户状态在账户数据变化时变化。账户状态包含四项信息：nonce、余额、账户存储内容根哈希值、账户代码哈希值。状态数据不直接存储在区块上。</li>
  <li style="margin-top:.3em;"><b>账户 Nonce</b>: 账户随机数，是账户的交易计数。以防止重放攻击。</li>
  <li style="margin-top:.3em;"><b>智能合约</b>: Smart Contract，是以太坊成为区块链 2.0 的立足点。以太坊支持通过图灵完备的高级编程语言编写智能合约代码。部署在链上后，可以接受来自外部的交易请求和事件，以触发执行特定的合约代码逻辑，进一步生成新的交易和事件。甚至调用其他的智能合约。</li>
  <li style="margin-top:.3em;"><b>世界状态</b>: state，管理账户地址到账户状态的映射关系。所有账户的状态构成整个区块链状态。</li>
  <li style="margin-top:.3em;"><b>交易</b>: Transaction，是外部与以太坊交互的唯一途径，必须由外部账户签名，矿工执行交易，最终打包到区块中。</li>
  <li style="margin-top:.3em;"><b>交易收据</b>: Receipt，是方便对交易进行零知识证明、索引和搜索，将交易执行过程中的一些特定信息编码为交易收据。</li>
  <li style="margin-top:.3em;"><b>区块</b>: block，是由一组交易和一些辅助信息（简称区块头）、其他区块头哈希构成的数据块。其他区块头哈希表示父区块或者叔区块。</li>
  <li style="margin-top:.3em;"><b>叔块</b>: Uncle Block，不能成为主链一部分的孤儿区块，如果有幸被后来的区块收留进区块链就变成了叔块。收留了孤块的区块有额外的奖励。孤块一旦成为叔块，该区块统一可获得奖励。通过叔块奖励机制，来降低以太坊软分叉和平衡网速慢的矿工利益。</li>
  <li style="margin-top:.3em;"><b>随机数</b>: nonce，记录在区块头中，努力工作的证明。</li>
  <li style="margin-top:.3em;"><b>Gas</b>: 燃料是交易打包到区块时，在EVM运行所消耗的资源量的一种形象化概念，比喻需要燃料才能运行EVM。在以太坊中，将CPU资源、存储资源按内置的规则，统一使用 Gas 作为资源单位表达。每执行一次虚拟机指令，均消耗一定的Gas。</li>
  <li style="margin-top:.3em;"><b>GasPrice</b>: 燃料价格，任何交易都需要包含一个愿意支付的燃料单价，最终根据交易消耗的燃料量，计算手续费(usedGas*gasPrice)支付给矿工。</li>
  <li style="margin-top:.3em;"><b>价格预测</b>: GPO(Gas Price Oracle)，Gas 价格预测，根据历史交易的GasPrice预测未来GasPrice走势。</li>
</ul>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="技术术语" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;margin-top:.625em;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;"><b>ZKP</b>: Zero Knowledge Proof，零知识证明。</li>
  <li style="margin-top:.3em;"><b>EVM</b>: Ethereum Virtual Machine，以太坊虚拟机是执行交易的一个轻量级沙盒虚拟机。</li>
  <li style="margin-top:.3em;"><b>Message</b>: 消息，是一个不能序列化的，并且只存在于以太坊运行环境中的虚拟对象，一条消息主要包括：消息的发送方、接收方、gasLimit等等；</li>
  <li style="margin-top:.3em;"><b>序列化</b>: 将数据使用RLP编码为一组字节数据，便于数据交换与存储。</li>
  <li style="margin-top:.3em;"><b>RLP</b>: 递归长度前缀编码，一种能够压缩数据的数据编码协议，在以太坊中常用于序列化数据。</li>
  <li style="margin-top:.3em;"><b>MPT</b>: 默克尔压缩前缀树， Merkle Patricia Tree，是一种经过改良的、融合了默克尔树和前缀树两种树结构优点的数据结构，是以太坊中用来组织管理账户数据、生成交易集合哈希的重要数据结构。</li>
  <li style="margin-top:.3em;"><b>Patricia Trie</b>: 一种压缩前缀树，是一种更节省空间的树，对于 trie 的每个节点，如果该节点是其父节点唯一的儿子的话，就和父节点结合；</li>
  <li style="margin-top:.3em;"><b>Merkle Tree</b>: 默克尔树，也称为 Hash Tree，默克尔树叶子节点的value是数据项的内容，或者是数据项的哈希值；非叶子节点的value根据其孩子节点的信息，然后按照Hash算法计算而得出的。</li>
  <li style="margin-top:.3em;"><b>Whisper</b>: 密语，是一种依托于P2P的通信协议，通过 Whisper </li>协议，节点可以将信息发送给某个特定节点，实现双节点私聊和按主题在多个节点上通信。主要用于大规模的点对点数据发现、信号协商、最小传输通信、完全隐私保护的 DApp 而设计的。</li>
  <li style="margin-top:.3em;"><b>LES</b>: Light Ethereum Subprotocol，以太坊客户端的轻量级的子协议，只需要下载区块头，其他详细信息可以按需获取；LES Wiki。</li>
  <li style="margin-top:.3em;"><b>Swarm</b>: 蜂巢，是一个分布式存储平台和内容分发服务，是以太坊 web 3 技术栈的本地基础层服务;</li>
  <li style="margin-top:.3em;"><b>LLL，Sperpent、Mutan和Solidity</b>: 用于编写智能合约代码的的编程语言，能被编译成EVM代码。</li>
  <li style="margin-top:.3em;"><b>ERC20</b>: 可以理解成 Ethereum 的一个 Token 协议规范，所有基于 Ethereum 开发的 Token 合约都遵守这个规范。遵守 ERC20 协议规范的 Token 可以被各种 Ethereum 钱包支持。</li>
  <li style="margin-top:.3em;"><b>ERC721</b>: 是在ERC20标准上建立的Token协议规范，是针对不可互换Token(non-fungible tokens 简称NFTs)做的智能合约标准。</li>
</ul>
   ]]>
    </c:sourceContent>
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>



  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">基础数据结构</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="链配置" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  不同于传统软件，因为区块链的不可篡改性，要求对同一个区块，不管出块时的软件版本，还是10年后的软件版本。都需要保证软件对已出块区块做出相同操作。因此区块链的链配置，不得随意更改，还需要维护重要历史变更内容。
</div>
<div style="margin-top:.625em;">
  下面是链的核心配置信息，定义在 params/config.go 中：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
type ChainConfig struct {

    ChainID *big.Int  
    HomesteadBlock *big.Int 
    DAOForkBlock   *big.Int  
    DAOForkSupport bool   

    // EIP150 implements the Gas price changes (https://github.com/ethereum/EIPs/issues/150)
    EIP150Block *big.Int     
    EIP150Hash  common.Hash 

    EIP155Block *big.Int  
    EIP158Block *big.Int  

    ByzantiumBlock      *big.Int  
    ConstantinopleBlock *big.Int  
    PetersburgBlock     *big.Int  
    EWASMBlock          *big.Int  

    // Various consensus engines
    Ethash *EthashConfig  
    Clique *CliqueConfig
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  区块链的不可篡改性，非中心化程序使得区块链网络程序升级复杂化。从链核心配置，可折射一个区块链网络所经历的关键时刻。
</div>
<div style="margin-top:.325em;">
  如上的以太坊链配置，并非程序期初编写，而是随以太坊发展，在共识协议重大变更时积累而成。 下面是各项配置的作用说明：
</div>
<h4 style="margin-top:.625em;">&hearts; ChainID</h4>
<div style="margin-top:.325em;">
  链标识符，是在 EIP155 改进方案中实现，用于防止重放攻击。
</div>
<div style="margin-top:.325em;">
  重放攻击是在以太坊第一次硬分叉（以太经典）时，引入的Bug。 导致一笔交易，在两条链上同样有效，造成双花。
</div>
<div style="margin-top:.325em;">
  当前以太坊生态中不同网络环境下的链网络信息:
</div>

<table style="width:100%;margin-top:.625em;">
  <thead>
    <tr>
      <th style="border: dashed 1px;padding: 5px 10px;">Chain ID</th>
      <th style="border: dashed 1px;padding: 5px 10px;">Name</th>
      <th style="border: dashed 1px;padding: 5px 10px;">Short Name</th>
      <th style="border: dashed 1px;padding: 5px 10px;width: 85px;">Chain</th>
      <th style="border: dashed 1px;padding: 5px 10px;">Network</th>
      <th style="border: dashed 1px;padding: 5px 10px;">Network ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">eth</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETH</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Expanse Network</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">exp</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">EXP</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">3</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Testnet Ropsten</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">rop</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETH</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ropsten</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">3</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">4 Ethereum Testnet Rinkeby</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">rin</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETH</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">rinkeby</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">4</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">5</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Testnet Görli</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">gor</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETH</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">goerli</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">5</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">6</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Classic Testnet Kotti</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">kot</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETC</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">kotti</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">6</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">8</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ubiq Network Mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ubq</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">UBQ</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">9</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ubiq Network Testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">tubq</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">UBQ</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">28</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Social</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">etsc</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETSC</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">30</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">RSK Mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">rsk</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">RSK</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">775</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">31</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">RSK Testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">trsk</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">RSK</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">8052</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">42</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Testnet Kovan</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">kov</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETH</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">kovan</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">42</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">60</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">GoChain</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">go</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">GO</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">60</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">61</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Classic Mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">etc</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETC</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">62</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethereum Classic Testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">tetc</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETC</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2</td>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">64</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ellaism</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ella</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ELLA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">76</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Mix</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mix</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">MIX</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">77</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">POA Network Sokol</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">poa</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">POA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">sokol</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">88</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">TomoChain</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">tomo</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">TOMO</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">88</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">99</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">POA Network Core</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">skl</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">POA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">core</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">100</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">xDAI Chain</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">xdai</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">XDAI</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">101</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Webchain</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">web</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">WEB</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">37129</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">101</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">EtherInc</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">eti</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETI</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">820</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Callisto Mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">clo</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">CLO</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">821</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Callisto Testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">tclo</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">CLO</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1620</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Atheios</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ath</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ATH</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">11235813</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1856</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Teslafunds</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">tsf</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">TSF</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1987</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">EtherGem</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">egem</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">EGEM</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1987</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2018</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">EOS Classic</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">eosc</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">EOSC</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">24484</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Webchain (after block xxxxxxx)</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">web</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">WEB</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">37129</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">31102</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ethersocial Network</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">esn</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ESN</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">200625</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Akaroma</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">aka</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">AKA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">200625</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">246529</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ARTIS sigma1</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ats</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ARTIS</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">sigma1</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">246529</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">246785</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ARTIS tau1</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ats</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ARTIS</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">tau1</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">246785</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1313114</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ether-1</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">etho</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ETHO</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">1313114</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">7762959</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Musicoin</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">music</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">MUSIC</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">7762959</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">18289463</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">IOLite</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ilt</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ILT</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">18289463</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">3125659152</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Pirl</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">pirl</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PIRL</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">3125659152</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">385</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Lisinski</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">lisinski</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">CRO</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">385</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">108</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ThunderCore Mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">TT</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">TT</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">108</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">18</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">ThunderCore Testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">TST</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">TST</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">18</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">11</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Metadium Mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">meta</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">META</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">mainnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">11</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">12</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Metadium Testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">kal</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">META</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">12</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">13371337</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PepChain Churchill</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">tpep</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PEP</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">testnet</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">13371337</td>
    </tr>
  </tbody>
</table>

<h4 style="margin-top:1em;">&hearts; HomesteadBlock</h4>
<div style="margin-top:.325em;">
  以太坊 homested 版本硬分叉高度。 意味着从此高度开始，新区块受 homested 版本共识规则约束。 因涉及共识变更，如果希望继续接受新区块则必须升级以太坊程序，属于区块链硬分叉。 如果不愿意接受共识变更，则可以独立使用新的 ChainID 继续原共识，且必须独立维护版本。
</div>
<h4 style="margin-top:.625em;">&hearts; DAOForkBlock和DAOForkSupport</h4>
<div style="margin-top:.325em;">
以太坊应对 <a href="https://learnblockchain.cn/books/geth/part6/dao.html">The DAO 攻击</a> 所实施的软件软分叉。在程序代码中嵌入关于 The DAO 账户控制代码，来锁定资产转移。
</div>
<div style="margin-top:.325em;">
这是以太坊首个ICO筹集资金达 1.5 亿美元的众筹项目，占有近以太坊总币 15%。攻击的影响关乎以太坊生死，以太坊基金会介入并组织社区投票决定，是否愿意通过修改程序来干预这个 ICO 智能合约，以避免资金流向黑客。
</div>
<div style="margin-top:.325em;">
最终因为社区的不同意见，利益与信念的交融，在 1920000 高度进行硬分叉。分叉出以太坊和以太经典。
</div>

<h4 style="margin-top:.625em;">&hearts; EIP150Block与EIP150Hash</h4>
<div style="margin-top:.325em;">
<a href="http://eips.ethereum.org/EIPS/eip-150">EIP150</a> 提案生效高度。该提案是为解决拒绝服务攻击，而通过提高 IO 操作相关的 Gas 来预防攻击。
</div>
<div style="margin-top:.325em;">
主要注意的是Go语言版并非以太坊的第一个实现版本，属于新语言重写。此部分代码是在2016年11月21日提交的#a8ca75中实现。而EIP150激活的区块高度是 2463000，在2016年10月18日出块。
</div>
<div style="margin-top:.325em;">
因此，在配置中特别写入了 EIP150 激活区块 2463000 的哈希值。
</div>

<h4 style="margin-top:.625em;">&hearts; ByzantiumBlock</h4>
<div style="margin-top:.325em;">
2017年10月16日，以太坊从第 4370000 号区块起顺利完成了代号为 Byzantium 的硬分叉。 Byzantium 是 Metropolis 升级计划中的第一步，为之后的 Constantinople 硬分叉做好了铺垫。
</div>

<h4 style="margin-top:.625em;">&hearts; ConstantinopleBlock</h4>
<div style="margin-top:.325em;">
以太坊君士坦丁堡版本启用区块高度，主网在2019年3月1日成功出块。Constantinople (君士坦丁堡) 包含一大波以太坊改进提案（EIP），涉及核心协议规范、客户端 API以及合约标准。下列 EIP 为君士坦丁堡升级中包含的更新：
</div>

<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;"><a href="https://eips.ethereum.org/EIPS/eip-145">EIP 145 -EVM 中的按位移动（bitwise shifting）指令</a>: 提供与其它算术运算代价相当的原生按位移动指令。 EVM 现在是没有按位移动指令的，但支持其他逻辑和算术运算。 按位移动可以通过算术操作来实现，但这样会有更高的 Gas 消耗，也需要更多时间来处理。 使用算术操作，实现 SHL 和 SHR 需要耗费 35 Gas，但这一提案提供的原生指令只需消耗 3 Gas。 一句话总结：该 EIP 为协议加入了一个原生的功能，使得 EVM 中的按位移动操作更便宜也更简单。</li>
  <li style="margin-top:.3em;"><a href="https://eips.ethereum.org/EIPS/eip-1014">EIP 1014-Skinny CREATE2</a>: 加入新的操作码 0xf5 ，需要 4 个堆栈参数（stack argument）: endowment 、 memory_start 、 memory_length 、 salt 。具体表现与 CREATE 相同，但使用 keccak256( 0xff ++ sender_address ++ salt ++ keccak256(init_code)))[12:] ，而不是 keccak256(RLP(sender_address, nonce))[12:] ，作为合约初始化的地址。 拓宽我们的交互范围：有些合约在链上还不存在，但可以确定只可能包含由 init_code 特定部分创建出来的代码，有了该 EIP 之后我们就可以和这样的合约交互。 对包含与合约的 conterfactual 交互的状态通道来说非常重要。 一句话总结：这一 EIP 让你可以与还没有被创建出来的合约交互。</li>
  <li style="margin-top:.3em;"><a href="https://eips.ethereum.org/EIPS/eip-1052">EIP 1052 EXTCODEHASH 操作码</a>: 指定了一个新的操作码，可以返回某合约代码的 keccak256 哈希值。 许多合约都需要检查某一合约的字节码，但并不需要那些字节码本身。比如，某个合约可能想检查另一合约的字节码是不是一组可行的实现之一；又或者它想分析另一合约的代码，把所有能通过分析的合约（即字节码匹配的合约）添加进白名单。 合约现在可以使用 EXTCODECOPY 操作码，但在那些只需要哈希值的情境下，这一操作码相对来说是比较贵的，尤其是对那些大型合约而言。新的操作码EXTCODEHASH 部署之后，就可以只返回某一合约字节码的 keccak256 哈希值。 一句话总结：该 EIP 会让相关操作变得更便宜（消耗更少的 Gas）。</li>
  <li style="margin-top:.3em;"><a href="https://eips.ethereum.org/EIPS/eip-1283">EIP 1283 改变 SSTORE 操作码所用 Gas 的计算方式</a>: 改变 SSTORE 操作码的净 Gas 计量方式，以启用合约存储的新用法，并在计算方式与当前大多数实现不匹配的情形下减少无谓的 Gas 消耗。 一句话总结：该 EIP 会让某些操作变得更便宜（只需更少的 Gas 即可完成操作），减少那些当前“多余”而昂贵的 Gas 消耗。</li>
  <li style="margin-top:.3em;"><a href="https://eips.ethereum.org/EIPS/eip-1234">EIP 1234-推迟难度炸弹爆炸的时间并调整区块奖励</a>: 平均出块时间会因为逐渐加速的难度炸弹（也叫做“冰河时期”）而不断上升。该 EIP 提议推迟难度炸弹约 12 个月，并且（为适应冰河期推迟）而减少区块奖励。 一句话总结：该 EIP 保证了我们不会在 PoS 准备好并实现之前使以太坊停止出块。</li>
</ul>

<h4 style="margin-top:.625em;">&hearts; PetersburgBlock</h4>
<div style="margin-top:.325em;">
以太坊彼得斯堡版本启用区块高度。 因为以太坊改进提案 <a href="https://eips.ethereum.org/EIPS/eip-1283">EIP1283</a> 可能会为攻击者提供窃取用户资金的代码漏洞。 为避免这种情况发生，团队决定在同一区块进行两个硬分叉（君士坦丁堡和彼得斯堡）。

该分叉将禁用已发现的缺陷协议。
</div>
   ]]>
    </c:sourceContent>
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>







  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">创世配置文件</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div>
创世区块作为第零个区块，其他区块直接或间接引用到创世区块。 因此节点启动之初必须载入正确的创世区块信息，且不得任意修改。
</div>
<div style="margin-top:.625em;">
以太坊允许通过创世配置文件来初始化创世区块，也可使用选择使用内置的多个网络环境的创世配置。 默认使用以太坊主网创世配置。
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div>
  如果你需要搭建以太坊私有链，那么了解创世配置是必须的，否则你大可不关心创世配置。 下面是一份 JSON 格式的创世配置示例：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
{
    "config": {
        "chainId": 1,
        "homesteadBlock": 1150000,
        "daoForkBlock": 1920000,
        "daoForkSupport": true,
        "eip150Block": 2463000,
        "eip150Hash": "0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0",
        "eip155Block": 2675000,
        "eip158Block": 2675000,
        "byzantiumBlock": 4370000,
        "constantinopleBlock": 7280000,
        "petersburgBlock": 7280000,
        "ethash": {}
    },
    "nonce": "0x42",
    "timestamp": "0x0",
    "extraData": "0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa",
    "gasLimit": "0x1388",
    "difficulty": "0x400000000",
    "mixHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "coinbase": "0x0000000000000000000000000000000000000000",
    "number": "0x0",
    "gasUsed": "0x0",
    "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
    "alloc": {
        "000d836201318ec6899a67540690382780743280": {
            "balance": "0xad78ebc5ac6200000"
        },
        "001762430ea9c3a26e5749afdb70da5f78ddbb8c": {
            "balance": "0xad78ebc5ac6200000"
        }
    }
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  根据配置用途可分为三大类：
</div>

<h4 style="margin-top:.625em;">&hearts; 链配置</h4>
<div>
  config 项是定义链配置，会影响共识协议，虽然链配置对创世影响不大，但新区块的出块规则均依赖链配置。关于链配置更多细节，请查看文章 <a href="https://learnblockchain.cn/books/geth/part1/config.html">《链参数配置》</a>。
</div>

<h4 style="margin-top:.625em;">&hearts; 创世区块头信息配置</h4>
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;"><b>nonce:</b> 随机数，对应创世区块 Nonce 字段。</li>
  <li style="margin-top:.3em;"><b>timestamp:</b> UTC时间戳，对应创世区块 Time字段。</li>
  <li style="margin-top:.3em;"><b>extraData:</b> 额外数据，对应创世区块 Extra 字段。</li>
  <li style="margin-top:.3em;"><b>gasLimit:</b> 必填，燃料上限，对应创世区块 GasLimit 字段。</li>
  <li style="margin-top:.3em;"><b>difficulty:</b> 必填，难度系数，对应创世区块 Difficulty 字段。搭建私有链时，需要根据情况选择合适的难度值，以便调整出块。</li>
  <li style="margin-top:.3em;"><b>mixHash:</b> 一个哈希值，对应创世区块的MixDigest字段。和 nonce 值一起证明在区块上已经进行了足够的计算。</li>
  <li style="margin-top:.3em;"><b>coinbase:</b> 一个地址，对应创世区块的Coinbase字段。</li>
</ul>

<h4 style="margin-top:.625em;">&hearts; 初始账户资产配置</h4>
<div>
  alloc 项是创世中初始账户资产配置。在生成创世区块时，将此数据集中的账户资产写入区块中，相当于预挖矿。这对开发测试和私有链非常好用，不需要挖矿就可以直接为任意多个账户分配资产。
</div>

   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="自定义创世文件" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.6em;background-color:white;font-weight:normal;padding-bottom: 0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  如果你计划部署以太坊私有网络或者一个独立的测试环境，那么需要自定义创世文件，并初始化它。为了统一沟通，推荐先在用户根目录创建一个文件夹 deepeth，以做为《以太坊设计与实现》电子书学习工作目录。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ mkdir $HOME/deepeth && cd $HOME/deepeth
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  再准备两个以太坊账户，以便在创世时存入资产。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ dgeth --datadir $HOME/deepeth account new
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  因为是学习使用，推荐使用统一密码 foobar，执行两次命令，创建好两个账户。这里使用 --datadir 参数指定以太坊运行时数据存放目录，是让大家将数据统一存放在一个本课程学习文件夹中。再将下面配置内容保存到 $HOME/deepeth/genesis.json 文件，其中 alloc 项替换成刚刚创建的两个以太坊账户地址。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
{
    "config": {
        "chainId": 8888,
        "homesteadBlock": 0,
        "daoForkBlock": 0,
        "daoForkSupport": true,
        "eip150Block": 0,
        "eip155Block": 0,
        "eip158Block": 0,
        "byzantiumBlock": 0,
        "constantinopleBlock": 0,
        "petersburgBlock": 0,
        "ethash": {}
    },
    "nonce": "0x42",
    "timestamp": "0x0",
    "extraData": "0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa",
    "gasLimit": "0x1388",
    "difficulty": "0x1",
    "alloc": {
        "093f59f1d91017d30d8c2caa78feb5beb0d2cfaf": {
            "balance": "0xffffffffffffffff"
        },
        "ddf7202cbe0aaed1c2d5c4ef05e386501a054406": {
            "balance": "0xffffffffffffffff"
        }
    }
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  然后，执行 geth 子命令 init 初始化创世区块。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ dgeth  --datadir $HOME/deepeth init genesis.json
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  执行成功后，便可启动该私有链：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ dgeth --maxpeers 0 --datadir $HOME/deepeth  console
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  执行如下命令，可以查看到前面创建的两个账户，均已有资产：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
> eth.getBalance(eth.accounts[0])
// 18446744073709551615
> eth.getBalance(eth.accounts[1])
// 18446744073709551615
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  至此，我们已完成创世定制版。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="内置的创世配置" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.6em;background-color:white;font-weight:normal;padding-bottom: 0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  上面我已完成自定义创世，但以太坊作为去中心平台，需要许多节点一起参与。仅仅为了测试，多个节点来搭建私有链比较麻烦。如果希望和别人一起联调，或者需要在测试网络中测试DAPP时，该怎么办呢？那么，可使用以太坊测试网络。以太坊公开的测试网络有 5 个，目前仍在运行的有 4 个，具体见下表格。
</div>

<table style="width:100%;margin-top:.625em;">
  <thead>
    <tr>
      <th style="border: dashed 1px;padding: 5px 10px;">测试网</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">共识机制</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">出块间隔</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">提供方</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">上线时间</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">备注</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">状态</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Morden</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PoW</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">--</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">以太坊官方</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2015.7</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">因难度炸弹被迫退役</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">stopped</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Ropsten</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PoW</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">30秒</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">以太坊官方</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2016.11</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">接替Morden</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">running</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Kovan</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PoA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">4秒</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">以太坊钱包Parity开发团队</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2017.3</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">不支持geth</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">running</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Rinkeby</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PoA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">15秒</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">以太坊官方</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2017.4</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">最常用，只支持geth</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">running</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Sokol</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PoA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">5秒</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">以太坊官方POA.network团队</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2017.12</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">不支持geth</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">running</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">Görli</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">PoA</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">15秒</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">以太坊柏林社区</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">2018.9</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">首个以太坊2.0实验场</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">running</td>
    </tr>
  </tbody>
</table>

<div style="margin-top:1em;">
  支持 geth 的3个测试网络的创世配置已内置在以太坊代码中，具体见 core/genesis.go 文件：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// DefaultTestnetGenesisBlock returns the Ropsten network genesis block.
func DefaultTestnetGenesisBlock() *Genesis{}
// DefaultRinkebyGenesisBlock returns the Rinkeby network genesis block.
func DefaultRinkebyGenesisBlock() *Genesis
// DefaultGoerliGenesisBlock returns the Görli network genesis block.
func DefaultGoerliGenesisBlock() *Genesis{}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
当然不会缺以太坊主网创世配置，也是 geth 运行的默认配置。
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// DefaultGenesisBlock returns the Ethereum main net genesis block.
func DefaultGenesisBlock() *Genesis{}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
如果你不想自定义创世配置文件用于开发测试，那么以太坊也提供一份专用于本地开发的配置。
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// DeveloperGenesisBlock returns the 'geth --dev' genesis block. Note, this must
// be seeded with the
func DeveloperGenesisBlock(period uint64, faucet common.Address) *Genesis
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
运行 dgeth --dev console 可临时运行使用。但如果需要长期使用此模式，则需要指定 datadir。
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
$ dgeth --dev --datadir $HOME/deepeth/dev console
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
首次运行 dev 模式会自动创建一个空密码的账户，并开启挖矿。 当有新交易时，将立刻打包出块。
   ]]>
    </c:sourceContent>

    <c:sourceContent type="html" title="geth 创世区块加载流程" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.6em;background-color:white;font-weight:normal;padding-bottom: 0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  在运行 geth 时需根据配置文件加载创世配置以及创世区块，并校验其合法性。 如果配置信息随意变更，易引起共识校验不通过等问题。 只有在加载并检查通过时，才能继续运行程序。
</div>
<div style="margin-top:1em;">
  下图是一个简要流程，下面分别讲解“加载创世配置”和“安装创世区块”两个子流程。
</div>
<div style="margin-top:1em;">
  <img style="width:300px" src="/images/deep-ether/07_20190407101509.webp" />
</div>
   ]]>
    </c:sourceContent>

    <c:sourceContent type="html" title="加载创世配置" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.6em;background-color:white;font-weight:normal;padding-bottom: 0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  应使用哪种创世配置，由用户在启动 geth 时决定。下图是创世配置选择流程图：
</div>
<div style="margin-top:1em;">
  <img style="width:650px" src="/images/deep-ether/07_WX20190407-103229.png" />
</div>
<div style="margin-top:1em;">
  通过 geth 命令参数可选择不同网络配置，可以通过 networkid 选择，也可使用网络名称启用。
</div>

<h4 style="margin-top:.625em;">&hearts; 使用 networkid:</h4>
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;">1=Frontier，主网环境，是默认选项。</li>
  <li style="margin-top:.3em;">2=Morden 测试网络，但已禁用。</li>
  <li style="margin-top:.3em;">3=Ropsten 测试网络。</li>
  <li style="margin-top:.3em;">4=Rinkeby 测试网络。</li>
</ul>
<h4 style="margin-top:.625em;">&hearts; 直接使用网络名称:</h4>
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;">testnet: Ropsten 测试网络。</li>
  <li style="margin-top:.3em;">rinkeby: Rinkeby 测试网络。</li>
  <li style="margin-top:.3em;">goerli: Görli 测试网络。</li>
  <li style="margin-top:.3em;">dev: 本地开发环境。</li>
</ul>

<div style="margin-top:1em;">
  geth 启动时根据不同参数选择加载不同网络配置，并对应不同网络环境。如果不做任何选择，虽然在此不会做出选择，但在后面流程中会默认使用主网配置。
</div>
   ]]>
    </c:sourceContent>


    <c:sourceContent type="html" title="安装创世区块" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.6em;background-color:white;font-weight:normal;padding-bottom: 0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  上面已初步选择创世配置，而这一步则根据配置加载或者初始化创世单元。 下图是处理流程：
</div>
<div style="margin-top:.625em;">
  <img style="width:550px" src="/images/deep-ether/07_安装创世区块.png" />
</div>
<div style="margin-top:.625em;">
  首先，需要从数据库中根据区块高度 0 读取创世区块哈希。 如果不存在则说明本地属于第一次启动，直接使用运行时创世配置来构建创世区块。 属于首次，还需要存储创世区块和链配置。
</div>
<div style="margin-top:.625em;">
  如果存在，则需要使用运行时创世配置构建创世区块并和本次已存储的创世区块哈希进行对比。 一旦不一致，则返回错误，不得继续。
</div>
<div style="margin-top:.625em;">
  随后，还需要检查链配置。先从数据库获取链配置，如果不存在，则无需校验直接使用运行时链配置。 否则，需要检查运行时链配置是否正确，只有正确时才能替换更新。 但有一个例外：主网配置不得随意更改，由代码控制而非人为指定。
</div>
<div style="margin-top:.625em;">
  总的来说，以太坊默认使用主网配置，只有在首次运行时才创建和存储创世区块，其他时候仅仅用于校验。 而链配置除主网外则在规则下可随时变更。
</div>
   ]]>
    </c:sourceContent>


    <c:sourceContent type="html" title="构建创建区块" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.6em;background-color:white;font-weight:normal;padding-bottom: 0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  上面我们已知晓总体流程，这里再细说下以太坊是如何根据创世配置生成创世区块。核心代码位于 core/genesis.go:229。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
func (g *Genesis) ToBlock(db ethdb.Database) *types.Block{
    if db == nil {
        db = rawdb.NewMemoryDatabase()
    }
    statedb, _ := state.New(common.Hash{}, state.NewDatabase(db)) // ❶
    for addr, account := range g.Alloc { // ❷
        statedb.AddBalance(addr, account.Balance)
        statedb.SetCode(addr, account.Code)
        statedb.SetNonce(addr, account.Nonce)
        for key, value := range account.Storage {
            statedb.SetState(addr, key, value)
        }
    }
    root := statedb.IntermediateRoot(false) // ❸
    head := &types.Header{ // ❹
        Number:     new(big.Int).SetUint64(g.Number),
        Nonce:      types.EncodeNonce(g.Nonce),
        Time:       g.Timestamp,
        ParentHash: g.ParentHash,
        Extra:      g.ExtraData,
        GasLimit:   g.GasLimit,
        GasUsed:    g.GasUsed,
        Difficulty: g.Difficulty,
        MixDigest:  g.Mixhash,
        Coinbase:   g.Coinbase,
        Root:       root,
    }
    // ❺
    if g.GasLimit == 0 {
        head.GasLimit = params.GenesisGasLimit
    }
    if g.Difficulty == nil {
        head.Difficulty = params.GenesisDifficulty
    }

    statedb.Commit(false) // ❻
    statedb.Database().TrieDB().Commit(root, true) // ❼

    return types.NewBlock(head, nil, nil, nil) // ❽
}
   ]]>
    </c:sourceContent>


    <c:sourceContent type="html" title="构建创建区块" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.6em;background-color:white;font-weight:normal;padding-bottom: 0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div>
  上面代码是根据创世配置生成创世区块的代码逻辑，细节如下：
</div>
<ul style="margin-left:2.5em;list-style:decimal;line-height:1.5em;">
  <li style="margin-top:.3em;">创世区块无父块，从零初始化全新的 state（后续文章会详细讲解 state对象）。</li>
  <li style="margin-top:.3em;">遍历配置中 Alloc 项账户集合数据，直接写入 state 中。 这里不单可以设置 balance，还可以设置 code、nonce 以及任意多个 storage 数据。意味着创世时便可以直接部署智能合约。例如下面配置则在创世时部署了一个名为 093f59f1d91017d30d8c2caa78feb5beb0d2cfaf 的智能合约。</li>
  <li style="margin-top:.3em;">将账户数据写入 state 后，便可以计算出 state 数据的默克尔树的根值，称之为 StateRoot。 此值记录在区块头 Root 字段中。</li>
  <li style="margin-top:.3em;">创世配置的一部分配置，则直接映射到区块头中，完成创世区块头的构建。</li>
  <li style="margin-top:.3em;">因为 GasLimit 和 Difficulty 直接影响到下一个区块出块处理。 因此未设置时使用默认配置(Difficulty=131072，GasLimit=4712388)。</li>
  <li style="margin-top:.3em;">提交 state，将 state 数据提交到底层的内存 trie 数据中。</li>
  <li style="margin-top:.3em;">将内存 trie 数据更新到 db 中。 这是多余的一步，因为提交到数据库是由外部进行，这里只需要负责生成区块。</li>
  <li style="margin-top:.3em;">利用区块头创建区块，且区块中无交易记录。</li>
</ul>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
"alloc": {
    "093f59f1d91017d30d8c2caa78feb5beb0d2cfaf": {
        "balance": "0xffffffffffffffff",
        "nonce": "0x3",
        "code":"0x606060",
        "storage":{
        "11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa":"1234ff"
        }
    }
}
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>







  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">账户基本概念</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-top:.625em;">
对比比特币的 “UTXO” 余额模型，以太坊使用“账户”余额模型。 以太坊丰富了账户内容，除余额外还能自定义存放任意多数据。 并利用账户数据的可维护性，构建智能合约账户。
</div>
<div style="margin-top:.625em;">
实际上以太坊是为了实现智能合约而提炼的账户模型。 以账户为单位，安全隔离数据。 账户间信息相互独立，互不干扰。 再配合以太坊虚拟机，让智能合约沙盒运行。
</div>
<div style="margin-top:.625em;">
以太坊作为智能合约操作平台，将账户划分为两类：外部账户（EOAs）和合约账户（contract account）。
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="外部账户" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
  EOAs-外部账户(external owned accouts)是由人们通过私钥创建的账户。 是真实世界的金融账户的映射，拥有该账户私钥的任何人都可以控制该账户。 如同银行卡，到ATM机取款时只需要密码输入正确即可交易。 这也是人类与以太坊账本沟通的唯一媒介，因为以太坊中的交易需要签名， 而只能使用拥有私有外部账户签名。
</div>
<div style="margin-top:.625em;">
外部账户特点总结：
</div>
<ul style="margin-left:2.5em;list-style:decimal;line-height:1.5em;">
  <li style="margin-top:.3em;">拥有以太余额。</li>
  <li style="margin-top:.3em;">能发送交易，包括转账和执行合约代码。</li>
  <li style="margin-top:.3em;">被私钥控制。</li>
  <li style="margin-top:.3em;">没有相关的可执行代码。</li>
</ul>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="合约账户" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
含有合约代码的账户。 被外部账户或者合约创建，合约在创建时被自动分配到一个账户地址， 用于存储合约代码以及合约部署或执行过程中产生的存储数据。 合约账户地址是通过SHA3哈希算法产生，而非私钥。 因无私钥，因此无人可以拿合约账户当做外部账户使用。 只能通过外部账户来驱动合约执行合约代码。
</div>
<div style="margin-top:.625em;">
下面是合约地址生成算法：Keccak256(rlp([sender,nonce])[12:]
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// crypto/crypto.go:74
func CreateAddress(b common.Address, nonce uint64) common.Address {
    data, _ := rlp.EncodeToBytes([]interface{}{b, nonce})
    return common.BytesToAddress(Keccak256(data)[12:])
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
因为合约由其他账户创建，因此将创建者地址和该交易的随机数进行哈希后截取部分生成。
</div>
<div style="margin-top:.625em;">
特别需要注意的是，在EIP1014中提出的另一种生成合约地址的算法。其目的是为状态通道提供便利，通过确定内容输出稳定的合约地址。 在部署合约前就可以知道确切的合约地址。下面是算法方法:keccak256( 0xff ++ address ++ salt ++ keccak256(init_code))[12:]。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// crypto/crypto.go:81
func CreateAddress2(b common.Address, salt [32]byte, inithash []byte) common.Address {
    return common.BytesToAddress(Keccak256([]byte{0xff}, b.Bytes(), salt[:], inithash)[12:])
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
合约账户特点总结：
</div>
<ul style="margin-left:2.5em;list-style:decimal;line-height:1.5em;">
  <li style="margin-top:.3em;">拥有以太余额。</li>
  <li style="margin-top:.3em;">有相关的可执行代码（合约代码）。</li>
  <li style="margin-top:.3em;">合约代码能够被交易或者其他合约消息调用。</li>
  <li style="margin-top:.3em;">合约代码被执行时可再调用其他合约代码。</li>
  <li style="margin-top:.3em;">合约代码被执行时可执行复杂运算，可永久地改变合约内部的数据存储。</li>
</ul>
<div style="margin-top:.625em;">
综上，下面表格列出两类账户差异，合约账户更优于外部账户。 但外部账户是人们和以太坊沟通的唯一媒介，和合约账户相辅相成。
</div>

<table style="width:100%;margin-top:.625em;">
  <thead>
    <tr>
      <th style="border: dashed 1px;padding: 5px 10px;">项</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">外部账户</th> 
      <th style="border: dashed 1px;padding: 5px 10px;">合约账户</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">私钥 private Key</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✔️</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✖️</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">余额 balance</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✔️</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✔️</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">代码 code</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✖️</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✔️</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">多重签名</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✖️</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">✔️</td>
    </tr>
    <tr>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">控制方式</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">私钥控制</td>
      <td style="border: dashed 1px darkgray;padding: 2px 5px;">通过外部账户执行合约</td>
    </tr>
  </tbody>
</table>

<div style="margin-top:.625em;">
上面有列出多重签名，是因为以太坊外部账户只由一个独立私钥创建，无法进行多签。但合约具有可编程性，可编写符合多重签名的逻辑，实现一个支持多签的账户。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="账户数据结构" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
以太坊数据以账户为单位组织，账户数据的变更引起账户状态变化。从而引起以太坊状态变化（关于以太坊状态，后续另写文章介绍）。
</div>
<div style="margin-top:.625em;">
在程序逻辑上两类账户的数据结构一致：
</div>
<div>
  <img style="width:480px;margin:auto;" src="/images/deep-ether/14_以太坊账户数据结.png" />
</div>
<div style="margin-top:.625em;">
对应代码如下：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// core/state/state_object.go:100
type Account struct {
    Nonce    uint64
    Balance  *big.Int
    Root     common.Hash
    CodeHash []byte
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
但在数据存储上稍有不同，因为外部账户无内部存储数据和合约代码，因此外部账户数据中 StateRootHash 和 CodeHash 是一个空默认值。 一旦属于空默认值，则不会存储对应物理数据库中。在程序逻辑上，存在 code 则为合约账户。即 CodeHash 为空值时，账户是一个外部账户，否则是合约账户。
</div>
<div>
  <img style="width:380px;margin:auto;" src="/images/deep-ether/14_以太坊账户数据存储结构.png" />
</div>
<div style="margin-top:.625em;">
上图是以太坊账户数据存储结构，账户内部实际只存储关键数据，而合约代码以及合约自身数据则通过对应的哈希值关联。因为每个账户对象，将作为一个以太坊账户树的一个叶子数据存储，不能太大。
</div>
<div style="margin-top:.625em;">
从以太坊作为一个世界态(World State)状态机视角看数据关系如下：
</div>
<div style="margin-top:.625em;">
  <img style="width:100%;margin:auto;" src="/images/deep-ether/19_ethereum-global-state.png" />
</div>
<div style="margin-top:.625em;">
在密码学领域，Nonce 代表一个只使用一次的数字。它往往是一个随机或伪随机数，以避免重复。以太坊账户中加入 Nonce，可避免重放攻击（具体细节，在讲解以太坊交易流程时介绍），但不是随机产生。账户 Nonce 起始值是 0，后续每触发一次账户执行则 Nonce 值计加一次。其中一处的计数逻辑如下：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// core/state_transition.go:212
st.state.SetNonce(msg.From(), st.state.GetNonce(sender.Address())+1)
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
这样的附加好处是，一般可将 Nonce 当做账户的交易次数计数器使用，特别是对于合约账户可以准确的记录合约被调用次数。
</div>
<div style="margin-top:.625em;">
而 Balance 则记录该账户所拥有的以太（ETH）数量，称为账户余额 (注意，这里的余额的单位是 Wei )。转移资产(Transfer)是在一个账户的 Balance上计加，在另外一个账户计减。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// core/evm.go:94
func Transfer(db vm.StateDB, sender, recipient common.Address, amount *big.Int) {
    db.SubBalance(sender, amount)
    db.AddBalance(recipient, amount)
}
// core/vm/evm.go:191
if !evm.Context.CanTransfer(evm.StateDB, caller.Address(), value) {
    return nil, gas, ErrInsufficientBalance
}
// core/vm/evm.go:214
evm.Transfer(evm.StateDB, caller.Address(), to.Address(), value)
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
当然必须保证转账方余额充足，在转移前需要 CanTransfer 检查，如果余额充足，则执行 Transfer 转移 Value 数量的以太。
</div>
<div style="margin-top:.625em;">
账户状态哈希值 StateRoot，是合约所拥有的方法、字段信息构成的一颗默克尔压缩前缀树（Merkle Patricia Tree 后续独立文章讲解）的根值，简单地讲是一颗二叉树的根节点值。 合约状态中的任意一项细微变动都最终引起 StateRoot 变化，因此合约状态变化会反映在账户的 StateRoot 上。
</div>
<div style="margin-top:.625em;">
同时，你可以直接利用 StateRoot 从 Leveldb 中快速读取具体的某个状态数据，如合约的创建者。 通过以太坊API web3.eth.getStorageAt 可读取合约中任意位置的数据。
</div>
<div style="margin-top:.625em;">
下面，我们通过一段示例代码，感受下以太坊账户数据存储。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
import(...)
var toAddr =common.HexToAddress
var toHash =common.BytesToHash

func main()  {

    statadb, _ := state.New(common.Hash{}, state.NewDatabase(rawdb.NewMemoryDatabase())) // ❶

    acct1:=toAddr("0x0bB141C2F7d4d12B1D27E62F86254e6ccEd5FF9a") // ❷
    acct2:=toAddr("0x77de172A492C40217e48Ebb7EEFf9b2d7dF8151B")

    statadb.AddBalance(acct1,big.NewInt(100))
    statadb.AddBalance(acct2,big.NewInt(888))

    contract:=crypto.CreateAddress(acct1,statadb.GetNonce(acct1)) // ❸
    statadb.CreateAccount(contract)
    statadb.SetCode(contract,[]byte("contract code bytes")) // ❹

    statadb.SetNonce(contract,1)
    statadb.SetState(contract,toHash([]byte("owner")),toHash(acct1.Bytes())) // ❺
    statadb.SetState(contract,toHash([]byte("name")),toHash([]byte("ysqi")))

    statadb.SetState(contract,toHash([]byte("online")),toHash([]byte{1})
    statadb.SetState(contract,toHash([]byte("online")),toHash([]byte{})) // ❻

    statadb.Commit(true) // ❼
    fmt.Println(string(statadb.Dump())) // ❽

}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
上面代码中，我们创建了三个账户，并且提交到数据库中。最终打印出当前数据中所有账户的数据信息：
</div>
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;">❶ 一行代码涉及多个操作。首先是创建一个内存KV数据库，再包装为 stata 数据库实例， 最后利用一个空的DB级的StateRoot，初始化一个以太坊 statadb。</li>
  <li style="margin-top:.3em;">❷ 定义两个账户 acct1和acct2，并分别添加100和888到账户余额。</li>
  <li style="margin-top:.3em;">❸ 模拟合约账户的创建过程，由外部账户 acct1 创建合约账户地址，并将此地址载入 statadb。</li>
  <li style="margin-top:.3em;">❹ 在将合约代码加入刚刚创建的合约账户中，在写入合约代码的同时， 会利用crypto.Keccak256Hash(code)计算合约代码哈希，保留在账户数据中。</li>
  <li style="margin-top:.3em;">❺ 模拟合约执行过程，涉及修改合约状态，新增三项状态数据owner,name和online，分别对应不同值。</li>
  <li style="margin-top:.3em;">❻ 这里和前面不同的是，是给状态online赋值为空[]byte{}，因为所有状态的默认值均是[]byte{}， 在提交到数据库时，如Leveldb 认为这些状态无有效值，会从数据库文件中删除此记录。 因此，此操作实际是一个删除状态online操作。</li>
  <li style="margin-top:.3em;">❼ 上面所有操作，还都只是发生在 statdb 内存中，并未真正的写入数据库文件。 执行Commit，才会将关于 statadb 的所有变更更新到数据库文件中。</li>
  <li style="margin-top:.3em;">❽ 一旦提交数据，则可以使用 Dump 命令从数据库中查找此 stata 相关的所有数据，包括所有账户。 并以 JSON 格式返还。这里，我们将返还结果直接打印输出。</li>
</ul>
<div style="margin-top:.625em;">
代码执行输出结果如下：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
{
    "root": "3a25b0816cf007c0b878ca7a62ba35ee0337fa53703f281c41a791a137519f00",
    "accounts": {
        "0bb141c2f7d4d12b1d27e62f86254e6cced5ff9a": {
            "balance": "100",
            "nonce": 0,
            "root": "56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
            "codeHash": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
            "code": "",
            "storage": {}
        },
        "77de172a492c40217e48ebb7eeff9b2d7df8151b": {
            "balance": "888",
            "nonce": 0,
            "root": "56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
            "codeHash": "c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
            "code": "",
            "storage": {}
        },
        "80580f576731dc1e1dcc53d80b261e228c447cdd": {
            "balance": "0",
            "nonce": 1,
            "root": "1f6d937817f2ac217d8b123c4983c45141e50bd0c358c07f3c19c7b526dd4267",
            "codeHash": "c668dac8131a99c411450ba912234439ace20d1cc1084f8e198fee0a334bc592",
            "code": "636f6e747261637420636f6465206279746573",
            "storage": {
                "000000000000000000000000000000000000000000000000000000006e616d65": "8479737169",
                "0000000000000000000000000000000000000000000000000000006f776e6572": "940bb141c2f7d4d12b1d27e62f86254e6cced5ff9a"
            }
        }
    }
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
我们看到这些显示数据，直接对应我们刚刚的所有操作。也只有合约账户才有 storage 和 code。而外部账户的 codeHash 和 root 值相同，是一个默认值。
   ]]>
    </c:sourceContent>


    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>








  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">以太坊交易-TRANSACTION</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-top:.625em;">
交易(Transaction)是指由一个外部账户转移一定资产给某个账户， 或者发出一个消息指令到某个智能合约。
</div>
<div style="margin-top:.625em;">
在以太坊网络中，交易执行属于一个事务。具有原子性、一致性、隔离性、持久性特点。
</div>
<ul style="margin-left:2.5em;list-style:decimal;line-height:1.5em;">
  <li style="margin-top:.3em;">原子性: 是不可分割的最小执行单位，要么做，要么不做。</li>
  <li style="margin-top:.3em;">一致性: 同一笔交易执行，必然是将以太坊账本从一个一致性状态变到另一个一致性状态。</li>
  <li style="margin-top:.3em;">隔离性: 交易执行途中不会受其他交易干扰。</li>
  <li style="margin-top:.3em;">持久性: 一旦交易提交，则对以太坊账本的改变是永久性的。后续的操作不会对其有任何影响。</li>
</ul>
<div style="margin-top:.625em;">
因为是事务型，因此我们需确保在执行事务前让交易符合一些设计要求。
</div>
<ul style="margin-left:2.5em;list-style:decimal;line-height:1.5em;">
  <li style="margin-top:.3em;">交易必须唯一，能区分不同交易且同一笔交易不能重复提交到账本中。</li>
  <li style="margin-top:.3em;">交易内容不得变化，每个节点收到的交易都必须一致，交易执行时账本状态变化也是一致的。</li>
  <li style="margin-top:.3em;">交易必须被合法签名，只有已正确签名的交易才能被执行。</li>
  <li style="margin-top:.3em;">交易不能占用过多系统资源，影响其他交易执行。</li>
</ul>
<div style="margin-top:.625em;">
对交易的设计要求，涉及软件系统的方方面面，但最基础部分还是交易数据本身。下面，我细说下交易在 geth 中设计。
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="交易数据结构" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
  图是以太坊交易数据结构，根据用途，我将其划分为四部分。
</div>
<div style="margin-top:1em;">
  <img style="width:100%" src="/images/deep-ether/24_transaction-struct.png" />
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
开头是一个 uint64 类型的数字，称之为随机数。用于撤销交易、防止双花和修改以太坊账户的 Nonce 值（细节在讲解交易执行流程时讲解）。
</div>
<div style="margin-top:.625em;">
第二部分是关于交易执行限制的设置，gas 为愿意供以太坊虚拟机运行的燃料上限。 gasPrice 是愿意支付的燃料单价。gasPrcie * gas 则为愿意为这笔交易支付的最高手续费。关于 gas 更多内容请阅读《理解Gas和手续费》。
</div>
<div style="margin-top:.625em;">
我从程序执行逻辑上可以这样解释第三部分。是交易发送者输入以太坊虚拟机执行此交易的初始信息： 虚拟机操作对象（接收方 To）、从交易发送方转移到操作对象的资产（Value），以及虚拟机运行时入参(input)。其中 To 为空时，意味着虚拟机无可操作对象，此时虚拟机将利用 input 内容部署一个新合约。
</div>
<div style="margin-top:.625em;">
第四部分是交易发送方对交易的签名结果，可以利用交易内容和签名结果反向推导出签名者，即交易发送方地址。
</div>
<div style="margin-top:.625em;">
四部分内容的组合，解决了交易安全问题、实现了智能合约的互动方式以及提供了灵活可调整的交易手续费。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="交易对象定义" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
  具体到代码上，geth 将交易对象定义为一个对外可访问的 Transation 对象和内嵌的对外部包不可见的 txdata 。
</div>
<div style="margin-top:.625em;">
  小写的 txdata 是 Go 语言的特性。首字母小写，则相当于其他编程语言中的 private 修饰符，表明该数据结构对外部包不可见。同样小写开头的对象字段(如 Transaction 中的 hash)，也表示外部包无法访问此字段。反之，首字母大写的类型、字段、方法等定义，视为public。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// core/types/transaction.go:38
type Transaction struct {
    data txdata
    // caches
    hash atomic.Value
    size atomic.Value
    from atomic.Value
}

type txdata struct {
    AccountNonce uint64     
    Price        *big.Int  
    GasLimit     uint64     
    Recipient    *common.Address 
    Amount       *big.Int
    Payload      []byte

    // Signature values
    V *big.Int
    R *big.Int
    S *big.Int

    // This is only used when marshaling to JSON.
    Hash *common.Hash `json:"hash" rlp:"-"`
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
首先看私有的 txdata 结构体中定义了交易消息中所有必要内容，依次对应前面所说的交易数据结构。有三点需要特别注意。
</div>
<div style="margin-top:.625em;">
一是因涉及哈希运算，因此不能随意调整字段定义顺序，非特殊处理情况下必须按要求定义字段。所以txdata中定义的字段，是符合以太坊交易消息内容顺序的。
</div>
<div style="margin-top:.625em;">
二是在涉及货币计算时，不能因为精度缺失引起计算不准确问题。因此在以太坊、比特币等所有区块链设计中，货币类型均是整数，但最小值1所代表的币值不一样。
</div>
<div style="margin-top:.625em;">
在以太坊中一个以太币等于 10的18次方 Amount，当要表示 100 亿以太币时，Amount 等于10的27次方。已远远超过Uint64所能表示的范围(0-18446744073709551615)。因此 geth 一律采用Go标准包提供的大数 big.Int 进行货币运算和定义货币。这里的Price和Amount均是 big.Int 指针类型。另外，关于签名的三个值也是因为数字太大，而采用 big.Int 类型。
</div>
<div style="margin-top:.625em;">
三是最后的Hash字段，这不属于交易内容的一部分，只是为了在交易的JSON中包含交易哈希。为了防止参与哈希运算，该字段被标记为rlp:"-"。
</div>
<div style="margin-top:.625em;">
其次，Transaction 还定义了三个缓存项：交易哈希值(hash)、交易大小(size)和交易发送方(from)。缓存的原因是使用频次高且CPU计算量大。
</div>
<div style="margin-top:.625em;">
在区块链中最见的是哈希运算，所有链上数据基本都要参与哈希运算。而哈希运算是CPU密集型的，因此有必要对一些哈希运算等进行缓存，降低CPU计算量。首次计算完交易哈希值后，便缓存交易哈希到 hash 字段上。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
func (tx *Transaction) Hash() common.Hash {
   if hash := tx.hash.Load(); hash != nil {
      return hash.(common.Hash)
   }
   v := rlpHash(tx)
   tx.hash.Store(v)
   return v
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
hash 是atomic.Value类型，这是Go标准包提供的原子操作对象。这样可防止并发引起多次哈希计算。首先原子加载哈希值，如果存在则返回。如果不存在，则对交易进行哈希计算(rlpHash，是以太坊的哈希算法)，将哈希结果保存并返回。
</div>
<div style="margin-top:.625em;">
第二个缓存是交易大小(size)。交易大小是指交易信息进行RLP编码后的数据大小。代表交易网络传输大小、代表交易占区块大小、代表交易存储大小。 每笔交易进入交易池都需要检查交易大小是否超过 32KB。推送交易数据给其他节点时也需结合交易大小，在不超过网络消息最大限制(默认10MB)下分包推送数据。为避免重复计算开销，在第一次计算后便缓存。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
func (tx *Transaction) Size() common.StorageSize {
   if size := tx.size.Load(); size != nil {
      return size.(common.StorageSize)
   }
   c := writeCounter(0)
   rlp.Encode(&c, &tx.data)
   tx.size.Store(common.StorageSize(c))
   return common.StorageSize(c)
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
如上，执行 rlp.Encode获得可得到数据大小，缓存结果并返回。
</div>
<div style="margin-top:.625em;">
rlp 是以太坊定义的一套区块链数据编码解码协议，而非采用常见的 gzip、json、Protobuf 编码格式。目的是为了尽可能地压缩数据，毕竟区块链数据结构中只有常见的几种数据类型，不需要复杂的协议涉及，即可满足要求。
</div>
<div style="margin-top:.625em;">
最后一个缓存项是交易发送方(from)。交易的发送方，是根据签名反向计算过程，同样是CPU密集型运算。为了保证交易合法性，程序中到处都有涉及取交易发送方地址和校验发送方的合法性。只有正确的签名才能得到发送方地址。因此对交易发送方也进行缓存。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom: 0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
//core/types/transaction_signing.go:72
func Sender(signer Signer, tx *Transaction) (common.Address, error) {
   if sc := tx.from.Load(); sc != nil {
      sigCache := sc.(sigCache) 
      if sigCache.signer.Equal(signer) {
         return sigCache.from, nil
      }
   }

   addr, err := signer.Sender(tx)
   if err != nil {
      return common.Address{}, err
   }
   tx.from.Store(sigCache{signer: signer, from: addr})
   return addr, nil
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-top:.625em;">
特殊指出是需要一个Signer进行解签名，同时通过signer获取Sender，合法时缓存并返回。但在使用缓存内容时，还需要检查前后两个 Signer 是否一致，因为不一样的Signer 算法不一样，获得的交易签名者也不相同。
</div>
<div style="margin-top:.625em;">
需要注意，上面三个缓存使用都在有一个前提条件：交易对象一旦创建，交易内容不得修改。这也是为何交易对象中单独定义在私有的 txdata 中，而非直接定义在 Transaction 中的原因之一。如下图所示，只能通过调用交易对象方法获取交易内容，无任何途径修改一个现有交易对象内容。
</div>
<div style="margin-top:1em;">
  <img style="width:450px" src="/images/deep-ether/27_Transaction-method.png" />
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="交易对象方法介绍" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
  交易对象 Transtion 除对外提供交易内容访问外，也定义了一些辅助方法。我们依次介绍下各个方法。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// ChainId() 和 Protected(): 从交易签名内容V中提取链ID。
func (tx *Transaction) ChainId() *big.Int {
  return deriveChainId(tx.data.V)
}

func (tx *Transaction) Protected() bool {
  return isProtectedV(tx.data.V)
}

// RLP接口实现方法
func (tx *Transaction) EncodeRLP(w io.Writer) error {
  return rlp.Encode(w, &tx.data)
}

func (tx *Transaction) DecodeRLP(s *rlp.Stream) error {
  _, size, _ := s.Kind()
  err := s.Decode(&tx.data)
  if err == nil {
     tx.size.Store(common.StorageSize(rlp.ListSize(size)))
  }
  return err
}

// 和其他面向对象语言不同，Go语言中只要对象有实现某个接口的所有方法，则认为该对象属于某接口类型。
// 这里Transaction 实现了rlp包中的Encoder和Decoder两个接口。
// 意味在进行RLP编码解码时，将通过自定义实现的两个方法进行。
// RLP编码解码交易，实际是将交易内容 txdata 进行编码解码。同时在解码交易时，缓存交易大小。
// rlp/encode.go:36
type Encoder interface {
  EncodeRLP(io.Writer) error
}

type Decoder interface {
  DecodeRLP(*Stream) error
}

// JSON接口实现
func (tx *Transaction) MarshalJSON() ([]byte, error) {
  hash := tx.Hash()
  data := tx.data
  data.Hash = &hash
  return data.MarshalJSON()
}

func (tx *Transaction) UnmarshalJSON(input []byte) error {
  var dec txdata
  if err := dec.UnmarshalJSON(input); err != nil {
     return err
  }
  withSignature := dec.V.Sign() != 0 || dec.R.Sign() != 0 || dec.S.Sign() != 0
  if withSignature {
     var V byte
     if isProtectedV(dec.V) {
        chainID := deriveChainId(dec.V).Uint64()
        V = byte(dec.V.Uint64() - 35 - 2*chainID)
     } else {
        V = byte(dec.V.Uint64() - 27)
     }
     if !crypto.ValidateSignatureValues(V, dec.R, dec.S, false) {
        return ErrInvalidSig
     }
  }
  *tx = Transaction{data: dec}
  return nil
}

// 这是实现了 json 标准包的编码解码方法，主要是给 web3 api 调用时返回符合要求的JSON格式数据。
// 编码时附加交易哈希，解码时还校验签名格式的正确性。下面是一个完整交易JSON格式数据示例。
// 应该有发现到所有数字类型的字段都是用十六进制数表示。
// 这是为了统一所有数据格式，为大数 big.Int 服务。在 web3js 库中专门内置了 bignumber 库处理大数。
// 那么，在Go代码中如何实现JSON输出十六进制数的呢？
{
  "nonce": "0x16",
  "gasPrice": "0x2",
  "gas": "0x1",
  "to": "0x0100000000000000000000000000000000000000",
  "value": "0x0",
  "input": "0x616263646566",
  "v": "0x25",
  "r": "0x3c46a1ff9d0dd2129a7f8fbc3e45256d85890d9d63919b42dac1eb8dfa443a32",
  "s": "0x6b2be3f225ae31f7ca18efc08fa403eb73b848359a63cd9fdeb61e1b83407690",
  "hash": "0xb848eb905affc383b4f431f8f9d3676733ea96bcae65638c0ada6e45038fb3a6"
}
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>








  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">以太坊区块-BLOCK</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-top:.625em;">
以太坊可以视为一个数据库，数据库数据的变更由交易催化。为了有效、有序管理交易，必须将一笔或多笔交易组成一个数据块，才能提交到数据库中。这个数据块即区块(Block)。一个区块不但包含了多笔交易，还记录一些额外数据，以便正确提交到数据库中。
</div>
<div style="margin-top:.625em;">
下图是以太坊区块数据结构与关系，讲解区块数据结构时不得不将其他数据一并呈现，只有掌握区块中各项数据来源才能真正了解区块链数据。
</div>
<div style="margin-top:1em;">
  <img style="width:100%" src="/images/deep-ether/19_ethereum-full-block-data-struct.png" />
</div>
<div style="margin-top:.625em;">
区块分为两部分：区块头(Header)和区块体(Body)。区块头信息量非常丰富，不但和上一个单元建立联系还记录了一些交易执行情况信息和矿工工作信息。在上图中涉及一个非常重要的概念 Trie，全名是默克尔压缩前缀树，这需要独立讲解。
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="区块头数据解释" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<h4 style="margin-top:.625em;">&hearts; parentHash</h4>
<div style="margin-top:.625em;">
  是一个哈希值，记录此区块直接引用的父区块哈希值。通过此记录，才能完整的将区块有序组织，形成一条区块链。并且可以防止父区块内容被修改，因为数据修改，区块哈希必然发生变化，因此一个区块直接或间接的强化了所有父辈区块，通过加密算法保证历史区块不可能被修改。
</div>
<h4 style="margin-top:.625em;">&hearts; sha3Uncles</h4>
<div style="margin-top:.625em;">
  是一个哈希值，表示区块引用的多个叔辈区块。在区块体中也包含了多个叔辈的区块头信息，而sha3Uncles则是叔块集的 RLPHASH 哈希值。在比特币中只有成功挖出区块并被其他节点接受时才能获得奖励，是所有矿工在争取记账权和连带的奖励。而以太坊稍有不同，不能成为主链一部分的孤儿区块，如果有幸被后来的区块收留进区块链就变成了叔块。收留了孤块的区块有额外的奖励。孤块一旦成为叔块，该区块统一可获得奖励。通过叔块奖励机制，来降低以太坊软分叉和平衡网速慢的矿工利益。
</div>
<h4 style="margin-top:.625em;">&hearts; miner</h4>
<div style="margin-top:.625em;">
  是一个地址，表示区块是此账户的矿工挖出，挖矿奖励将下发到此账户。
</div>
<h4 style="margin-top:.625em;">&hearts; stateRoot</h4>
<div style="margin-top:.625em;">
  是一个哈希值，表示执行完此区块中的所有交易后以太坊状态快照ID。因为以太坊描述为一个状态机系统，因此快照ID称之为状态哈希值。又因为状态哈希是由所有账户状态按默克尔前缀树算法生成，因此称为状态默克尔树根值。
</div>
<h4 style="margin-top:.625em;">&hearts; transactionsRoot</h4>
<div style="margin-top:.625em;">
  是一个哈希值，表示该区块中所有交易生成一颗默克尔树根节点哈希值。是一个密码学保证交易集合摘要。通过此Root可以直接校验某交易是否包含在此区块中。
</div>
<h4 style="margin-top:.625em;">&hearts; receiptRoot</h4>
<div style="margin-top:.625em;">
  是一个哈希值，同样是默克尔树根节点哈希值。由区块交易在执行完成后生成的交易回执信息集合生成。
</div>
<h4 style="margin-top:.625em;">&hearts; logsBloom</h4>
<div style="margin-top:.625em;">
  是一个256长度Byte数组。提取自receipt，用于快速定位查找交易回执中的智能合约事件信息。
</div>
<h4 style="margin-top:.625em;">&hearts; difficulty</h4>
<div style="margin-top:.625em;">
  是 big.Int 值，表示此区块能被挖出的难度系数。
</div>
<h4 style="margin-top:.625em;">&hearts; number</h4>
<div style="margin-top:.625em;">
  是 big.Int 值，表示此区块高度。用于对区块标注序号，在一条区块链上，区块高度必须是连续递增。
</div>
<h4 style="margin-top:.625em;">&hearts; gasLimit</h4>
<div style="margin-top:.625em;">
  是 uint64 值，表示此区块所允许消耗的Gas燃料量。此数值根据父区块进行动态调整，调整的目的是调整区块所能包含的交易数量。
</div>
<h4 style="margin-top:.625em;">&hearts; gasUsed</h4>
<div style="margin-top:.625em;">
  是 uint64 值，表示此区块所有交易执行所实际消耗的Gas燃料量。
</div>
<h4 style="margin-top:.625em;">&hearts; timestamp</h4>
<div style="margin-top:.625em;">
  是 uint64 值，表示此区块创建的UTC时间戳，单位秒。因为以太坊平均14.5s出一个区块(白皮书中研究是 12秒)，因此区块时间戳可以充当时间戳服务，但不能完全信任。
</div>
<h4 style="margin-top:.625em;">&hearts; extraData</h4>
<div style="margin-top:.625em;">
  是一个长度不固定的Byte数组，最长32位。完全由矿工自定义，矿工一般会写一些公开推广类内容或者作为投票使用。
</div>
<h4 style="margin-top:.625em;">&hearts; mixHash</h4>
<div style="margin-top:.625em;">
  是一个哈希值。用于校验区块是否正确挖出。实际上是区块头数据不包含nonce时的一个哈希值。
</div>
<h4 style="margin-top:.625em;">&hearts; nonce</h4>
<div style="margin-top:.625em;">
  是一个8长度的Byte，实际是一个 uint64 值。用于校验区块是否正确挖出，mixHash 只有用一个正确的 nonce 才能进行PoW工作量证明。
</div>
<h4 style="margin-top:.625em;">&hearts; 区块体数据解释</h4>
<div style="margin-top:.625em;">
  区块体 Body 中只有两项数据：交易集合和叔辈区块头集合。是交易促使以太坊世界态进行转变。
</div>
<div style="margin-top:1em;">
  <img style="width:100%" src="/images/deep-ether/19_ethereum-state-change.webp" />
</div>
<div style="margin-top:.625em;">
  从创世状态开始，每一个区块中的交易执行促使了以太坊世界态的转变。下一个状态是在上一个状态中执行交易或其他操作使得状态由A状态转变为B状态。
</div>
<div style="margin-top:.625em;">
  而交易则为状态转变的催化酶，一个区块中的所有交易执行完成后，将使得以太坊进入一个新的状态。状态转变过程中记录了一些起始变量和结果数据，分别是交易默克尔哈希值transactionsRoot、交易回执默克尔哈希值 receiptRoot、事件布隆值logsBloom、新状态的默克尔哈希值stateRoot。
</div>
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>





  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">其他概念</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-top:.625em;">
有三个重要概念尚未解释，是因为篇幅有限，后续将逐一讲解。
</div>
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;">MPT：默克尔压缩前缀树， Merkle Patricia Tree，是一种经过改良的、融合了默克尔树和前缀树两种树结构优点的数据结构，是以太坊中用来组织管理账户数据、生成交易集合哈希的重要数据结构。
  <li style="margin-top:.3em;">Receipt，是方便对交易进行零知识证明、索引和搜索，将交易执行过程中的一些特定信息编码为交易收据。</li>
  <li style="margin-top:.3em;">工作量证明，以太坊设计的的ETHHASH。</li>
</li>
</ul>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>






  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">关键代码</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
下面是以太坊代码中定义的区块头和区块体结构定义代码，所有核心代码均在 core/types/block.go 文件中：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
// core/types/block.go:70
type Header struct {
   ParentHash  common.Hash    `json:"parentHash"       gencodec:"required"`
   UncleHash   common.Hash    `json:"sha3Uncles"       gencodec:"required"`
   Coinbase    common.Address `json:"miner"            gencodec:"required"`
   Root        common.Hash    `json:"stateRoot"        gencodec:"required"`
   TxHash      common.Hash    `json:"transactionsRoot" gencodec:"required"`
   ReceiptHash common.Hash    `json:"receiptsRoot"     gencodec:"required"`
   Bloom       Bloom          `json:"logsBloom"        gencodec:"required"`
   Difficulty  *big.Int       `json:"difficulty"       gencodec:"required"`
   Number      *big.Int       `json:"number"           gencodec:"required"`
   GasLimit    uint64         `json:"gasLimit"         gencodec:"required"`
   GasUsed     uint64         `json:"gasUsed"          gencodec:"required"`
   Time        uint64         `json:"timestamp"        gencodec:"required"`
   Extra       []byte         `json:"extraData"        gencodec:"required"`
   MixDigest   common.Hash    `json:"mixHash"`
   Nonce       BlockNonce     `json:"nonce"`
}

type Body struct {
  Transactions []*Transaction
  Uncles       []*Header
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:1em;">
创建一个区块需要调用函数 NewBlock：
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
func NewBlock(header *Header, txs []*Transaction, uncles []*Header, receipts []*Receipt) *Block {

   b := &Block{header: CopyHeader(header), td: new(big.Int)}

   // TODO: panic if len(txs) != len(receipts)
   if len(txs) == 0 {
      b.header.TxHash = EmptyRootHash
   } else {
      b.header.TxHash = DeriveSha(Transactions(txs))
      b.transactions = make(Transactions, len(txs))
      copy(b.transactions, txs)
   }

   if len(receipts) == 0 {
      b.header.ReceiptHash = EmptyRootHash
   } else {
      b.header.ReceiptHash = DeriveSha(Receipts(receipts))
      b.header.Bloom = CreateBloom(receipts)
   }

   if len(uncles) == 0 {
      b.header.UncleHash = EmptyUncleHash
   } else {
      b.header.UncleHash = CalcUncleHash(uncles)
      b.uncles = make([]*Header, len(uncles))
      for i := range uncles {
         b.uncles[i] = CopyHeader(uncles[i])
      }
   }

   return b
}
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>






  <c:entry style="margin-top:1em;">
    <c:title><![CDATA[<div style="color:blue;font-size:1.2em;">以太坊交易回执-RECEIPT</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
不同于比特币，以太坊作为智能合约平台。每一笔交易作为消息在以太坊虚拟机中执行时，均会获得一个交易回执信息(Receipt)。形同在银行转账后，可以获得关于这笔转账的交易电子回单。
</div>
<div style="margin-top:1em;">
  <img style="width:100%" src="/images/deep-ether/21_Transaction-receipt.png" />
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
同样，在以太坊中一份交易回执记录了关于此笔交易的处理结果信息：
</div>
<div style="margin-top:1em;">
  <img style="width:450px" src="/images/deep-ether/21_ethereum-tx-receipt-struct.png" />
</div>
<div style="margin-top:.625em;">
回执信息分为三部分：共识信息、交易信息、区块信息。下面分别介绍各类信息。
</div>
<div style="margin-top:1em;">
  <img style="width:450px" src="/images/deep-ether/21_ethereum-tx-receipt-struct-category.png" />
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="交易回执共识信息" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
共识意味在在校验区块合法性时，这部分信息也参与校验。这些信息参与校验的原因是确保交易必须在区块中的固定顺序中执行，且记录了交易执行后的状态信息。这样可强化交易顺序。
</div>
<ul style="margin-left:2em;list-style:disc;line-height:1.5em;">
  <li style="margin-top:.3em;">Status: 成功与否，1表示成功，0表示失败。注意在高度1035301前，并非1或0，而是 StateRoot，表示此交易执行完毕后的以太坊状态。</li>
  <li style="margin-top:.3em;">CumulativeGasUsed: 区块中已执行的交易累计消耗的Gas，包含当前交易。</li>
  <li style="margin-top:.3em;">Logs: 当前交易执行所产生的智能合约事件列表。</li>
  <li style="margin-top:.3em;">Bloom: 是从 Logs 中提取的事件布隆过滤器，用于快速检测某主题的事件是否存在于Logs中。</li>
</ul>
<div style="margin-top:.625em;">
这些信息是如何参与共识校验的呢？实际上参与校验的仅仅是回执哈希，而回执哈希计算只包含这些信息。首先，在校验时获取整个区块回执信息的默克尔树的根哈希值。再判断此哈希值是否同区块头定义内容相同。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
// core/block_validator.go:92
receiptSha := types.DeriveSha(receipts)
if receiptSha != header.ReceiptHash {
   return fmt.Errorf("invalid receipt root hash (remote: %x local: %x)",
   header.ReceiptHash, receiptSha)
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:black;font-size:1.2em;background-color:white;font-weight:normal;padding-bottom:0;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-top:.625em;">
而函数 types.DeriveSha 中生成根哈希值，是将列表元素（这里是交易回执）的RLP编码信息构成默克树，最终获得列表的哈希值。
</div>
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>


</c:component>
