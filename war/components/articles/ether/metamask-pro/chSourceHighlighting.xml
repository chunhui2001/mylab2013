<?xml version="1.0" encoding="utf-8"?>
<c:component type="chSourceHighlighting" componentId="chSourceHighlighting_1" xmlns:c="http://com.snnmo.website">
  <c:abstract style="font-size:1em;line-height:1.6em;">
    <![CDATA[
<div style="margin-bottom:1em;">
metamask 源码分析系列文章，基于 7.4.0 版本
</div>
<div style="margin-bottom:1em;">
<h1>GitHub: <a href="https://github.com/MetaMask/metamask-extension">https://github.com/MetaMask/metamask-extension</a></h1>
</div>
<ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;">
  <li style="margin: .325em 0;"><p>metamask 架构</p></li>
  <li style="margin: .325em 0;"><p>metamask 开发</p></li>
  <li style="margin: .325em 0;">
    <p>参考资料</p>
    <ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;">
      <li>Chrome Extension Development</li>
      <li>Stream</li>
    </ul>
  </li>
  <li>
    <p><a href="#metamask-dependencies" style="color:firebrick;text-decoration: underline;">metamask 依赖分析</a></p>
    <ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;">
      <li><a href="#3box" style="color:firebrick;text-decoration: underline;">3box</a></li>
      <li><a href="#eth-block-tracker" style="color:firebrick;text-decoration: underline;">eth-block-tracker</a></li>
      <li><a href="#json-rpc-engine" style="color:firebrick;text-decoration: underline;">json-rpc-engine</a></li>
      <li><a href="#json-rpc-middleware-stream" style="color:firebrick;text-decoration: underline;">json-rpc-middleware-stream</a></li>
      <li><a href="#metamask-inpage-provider" style="color:firebrick;text-decoration: underline;">metamask-inpage-provider</a></li>
      <li><a href="#nonce-tracker" style="color:firebrick;text-decoration: underline;">nonce-tracker</a></li>
      <li><a href="#obs-store" style="color:firebrick;text-decoration: underline;">obs-store</a></li>
      <li><a href="#post-message-stream" style="color:firebrick;text-decoration: underline;">post-message-stream</a></li>
    </ul>
  </li>
  <li style="margin: .325em 0;">
    <p>metamask 目录</p>
    <ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;">
      <li>
        <p>UI</p>
        <ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;">
          <li>MetaMask UI 编写规则</li>
          <li>ui/index.js</li>
        </ul>
      </li>
      <li>
        <p>app</p>
        <ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;">
          <li>app/scripts/account-import-strategies/index.js</li>
          <li>app/scripts/controllers/network/createInfuraClient.js</li>
          <li>app/scripts/controllers/network/createJsonRpcClient.js</li>
          <li>app/scripts/controllers/network/createLocalhostClient.js</li>
          <li>app/scripts/controllers/network/createMetamaskMiddleware.js</li>
          <li>app/scripts/controllers/network/network.js</li>
          <li>app/scripts/controllers/transactions
          <li>app/scripts/controllers/transactions/lib/tx-state-history-helper.js</li>
          <li>app/scripts/controllers/transactions/lib/util.js</li>
          <li>app/scripts/controllers/transactions/tx-state-manager.js</li>
          <li>app/scripts/controllers/transactions/pending-tx-tracker.js</li>
          <li>app/scripts/controllers/transactions/tx-gas-utils.js</li>
          <li>app/scripts/controllers/transactions/index.js</li>
          <li>app/scripts/controllers/balance.js</li>
          <li>app/scripts/controllers/cached-balances.js</li>
          <li>app/scripts/controllers/detect-tokens.js</li>
          <li>app/scripts/controllers/incoming-transactions.js</li>
          <li>app/scripts/controllers/preferences.js</li>
          <li>app/scripts/controllers/provider-approval.js</li>
          <li>app/scripts/controllers/recent-blocks.js</li>
          <li>app/scripts/controllers/threebox.js</li>
          <li>app/scripts/controllers/token-rates.js</li>
          <li>app/scripts/lib/ens-ipfs/resolver.js</li>
          <li>app/scripts/lib/ens-ipfs/setup.js</li>
          <li>app/scripts/lib/migrator/index.js</li>
          <li>app/scripts/lib/account-tracker.js</li>
          <li>app/scripts/lib/diagnostics-reporter.js</li>
          <li>app/scripts/lib/message-manager.js</li>
          <li>app/scripts/lib/pending-balance-calculator.js</li>
          <li>app/scripts/lib/personal-message-manager.js</li>
          <li>app/scripts/lib/stream-utils.js</li>
          <li>app/scripts/lib/typed-message-manager.js</li>
          <li>app/scripts/lib/util.js</li>
          <li>app/scripts/background.js</li>
          <li>app/scripts/chromereload.js</li>
          <li>app/scripts/contentscript.js</li>
          <li>app/scripts/createStandardProvider.js</li>
          <li>app/scripts/edge-encryptor.js</li>
          <li>app/scripts/inpage.js</li>
          <li>app/scripts/metamask-controller.js</li>
          <li>app/scripts/ui.js</li>
          <li>app/manifest.json</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
]]>
  </c:abstract>
  
  <c:entry style="margin-top:1em;">
    <c:title id="metamask-dependencies"><![CDATA[<div style="color:blue;font-size:1.2em;">metamask 依赖分析</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
metamask 由于项目比较久，用的依赖有新有旧，有很多已经过时不维护了，有的功能有重复。
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="package.json" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:.625em;line-height:1em;font-family:monospace;">
      <![CDATA[
{
  "name": "metamask-crx",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    // 开发构建 with logging and file watching
    "start": "gulp dev:extension",
    // 发布构建
    "dist": "gulp dist",
    // 生成文档
    "doc": "jsdoc -c development/.jsdoc.json",
    // 发布文档
    "publish-docs": "gh-pages -d docs/jsdocs",
    // 测试相关
    "start:test": "gulp dev:test",
    "build:test": "gulp build:test",
    "test": "yarn test:unit && yarn lint",
    // e2e dapp test
    "dapp": "static-server test/e2e/contract-test --port 8080",
    // e2e dapp test by ganache
    "dapp-chain": "GANACHE_ARGS='-b 2' concurrently -k -n ganache,dapp -p '[{time}][{name}]' 'yarn ganache:start' 'sleep 5 && static-server test/e2e/contract-test --port 8080'",
    "watch:test:unit": "nodemon --exec \"yarn test:unit\" ./test ./app ./ui",
    "sendwithprivatedapp": "static-server test/e2e/send-eth-with-private-key-test --port 8080",
    "test:unit": "cross-env METAMASK_ENV=test mocha --exit --require test/setup.js --recursive \"test/unit/**/*.js\" \"ui/app/**/*.test.js\"",
    "test:unit:global": "mocha test/unit-global/*",
    "test:single": "cross-env METAMASK_ENV=test mocha --require test/helper.js",
    "test:integration": "yarn test:integration:build && yarn test:flat",
    "test:integration:build": "gulp build:scss",
    "test:e2e:chrome": "SELENIUM_BROWSER=chrome test/e2e/run-all.sh",
    "test:web3:chrome": "SELENIUM_BROWSER=chrome test/e2e/run-web3.sh",
    "test:web3:firefox": "SELENIUM_BROWSER=firefox test/e2e/run-web3.sh",
    "test:e2e:firefox": "SELENIUM_BROWSER=firefox test/e2e/run-all.sh",
    "test:coverage": "nyc --reporter=text --reporter=html npm run test:unit",
    "test:coveralls-upload": "if [ $COVERALLS_REPO_TOKEN ]; then nyc report --reporter=text-lcov | coveralls; fi",
    "test:flat": "yarn test:flat:build && karma start test/flat.conf.js",
    "test:flat:build": "yarn test:flat:build:ui && yarn test:flat:build:tests && yarn test:flat:build:locales",
    "test:flat:build:tests": "node test/integration/index.js",
    "test:flat:build:states": "node development/genStates.js",
    "test:flat:build:locales": "mkdirp dist/chrome && cp -R app/_locales dist/chrome/_locales",
    "test:flat:build:ui": "yarn test:flat:build:states && browserify --transform babelify --transform brfs ./development/mock-dev.js -o ./development/bundle.js",
    "ganache:start": "./development/run-ganache",
    "sentry:publish": "node ./development/sentry-publish.js",
    // lint
    "lint": "eslint . --ext js,json",
    "lint:fix": "eslint . --ext js,json --fix",
    "lint:changed": "{ git ls-files --others --exclude-standard ; git diff-index --name-only --diff-filter=d HEAD ; } | grep --regexp='[.]js$' --regexp='[.]json$' | tr '\\n' '\\0' | xargs -0 eslint",
    "lint:changed:fix": "{ git ls-files --others --exclude-standard ; git diff-index --name-only --diff-filter=d HEAD ; } | grep --regexp='[.]js$' --regexp='[.]json$' | tr '\\n' '\\0' | xargs -0 eslint --fix",
    // 语言文件校验
    "verify-locales": "node ./development/verify-locale-strings.js",
    "mozilla-lint": "addons-linter dist/firefox",
    "watch": "cross-env METAMASK_ENV=test mocha --watch --require test/setup.js --reporter min --recursive \"test/unit/**/*.js\" \"ui/app/**/*.test.js\"",
    "devtools:react": "react-devtools",
    "devtools:redux": "remotedev --hostname=localhost --port=8000",
    // start the React DevTools and Redux DevTools Extension alongside the app
    // 主要用于开发
    "start:dev": "concurrently -k -n build,react,redux yarn:start yarn:devtools:react yarn:devtools:redux",
    "announce": "node development/announcer.js",
    "version:bump": "node development/run-version-bump.js",
    // 这里 storybook 启动有点问题
    // 需要 yarn add -D @storybook/addon-actions babel-loader 
    // 然后改造 .storybook/webpack.config.js ，增加 css rule，要不会报错
    "storybook": "start-storybook -p 6006 -c .storybook",
    "update-changelog": "./development/auto-changelog.sh",
    "rollback": "./development/rollback.sh"
  },
  "resolutions": {
    "3box/ipfs/ipld-zcash/zcash-bitcore-lib/lodash": "^4.17.12",
    "pubnub/superagent-proxy": "^2.0.0"
  },
  "dependencies": {
    "3box": "^1.10.2",
    "@babel/runtime": "^7.5.5",
    "@material-ui/core": "1.0.0",
    "@sentry/browser": "^4.1.1",
    "@zxing/library": "^0.8.0",
    "abi-decoder": "^1.2.0",
    "abortcontroller-polyfill": "^1.3.0",
    "asmcrypto.js": "^2.3.2",
    "await-semaphore": "^0.1.1",
    "bignumber.js": "^4.1.0",
    "bip39": "^2.2.0",
    "bluebird": "^3.5.0",
    "bn.js": "^4.11.7",
    "boron": "^0.2.3",
    "browser-passworder": "^2.0.3",
    "browserify-derequire": "^0.9.4",
    "browserify-unibabel": "^3.0.0",
    "c3": "^0.6.7",
    "classnames": "^2.2.5",
    "clone": "^2.1.2",
    "content-hash": "^2.4.4",
    "copy-to-clipboard": "^3.0.8",
    "currency-formatter": "^1.4.2",
    "d3": "^5.7.0",
    "debounce": "1.1.0",
    "debounce-stream": "^2.0.0",
    "deep-extend": "^0.5.1",
    "deep-freeze-strict": "1.1.1",
    "detect-node": "^2.0.3",
    "detectrtc": "^1.3.6",
    "dnode": "^1.2.2",
    "end-of-stream": "^1.1.0",
    "eth-block-tracker": "^4.4.2",
    "eth-contract-metadata": "^1.9.2",
    "eth-ens-namehash": "^2.0.8",
    "eth-json-rpc-errors": "^1.1.0",
    "eth-json-rpc-filters": "^4.1.1",
    "eth-json-rpc-infura": "^4.0.1",
    "eth-json-rpc-middleware": "^4.2.0",
    "eth-keyring-controller": "^5.3.0",
    "eth-ledger-bridge-keyring": "^0.2.0",
    "eth-method-registry": "^1.2.0",
    "eth-phishing-detect": "^1.1.4",
    "eth-query": "^2.1.2",
    "eth-sig-util": "^2.3.0",
    "eth-token-tracker": "^1.1.10",
    "eth-trezor-keyring": "^0.4.0",
    "ethereumjs-abi": "^0.6.4",
    "ethereumjs-tx": "1.3.7",
    "ethereumjs-util": "5.1.0",
    "ethereumjs-wallet": "^0.6.0",
    "etherscan-link": "^1.0.2",
    "ethjs": "^0.4.0",
    "ethjs-contract": "^0.2.3",
    "ethjs-ens": "^2.0.0",
    "ethjs-query": "^0.3.4",
    "extension-port-stream": "^1.0.0",
    "extensionizer": "^1.0.1",
    "fast-json-patch": "^2.0.4",
    "fuse.js": "^3.2.0",
    "gaba": "^1.8.0",
    "human-standard-token-abi": "^2.0.0",
    "jazzicon": "^1.2.0",
    "json-rpc-engine": "^5.1.4",
    "json-rpc-middleware-stream": "^2.1.1",
    "jsonschema": "^1.2.4",
    "lodash.debounce": "^4.0.8",
    "lodash.shuffle": "^4.2.0",
    "loglevel": "^1.4.1",
    "luxon": "^1.8.2",
    "metamask-inpage-provider": "^3.0.0",
    "metamask-logo": "^2.1.4",
    "mkdirp": "^0.5.1",
    "multihashes": "^0.4.12",
    "nonce-tracker": "^1.0.0",
    "number-to-bn": "^1.7.0",
    "obj-multiplex": "^1.0.0",
    "obs-store": "^4.0.3",
    "percentile": "^1.2.0",
    "pify": "^3.0.0",
    "polyfill-crypto.getrandomvalues": "^1.0.0",
    "post-message-stream": "^3.0.0",
    "promise-filter": "^1.1.0",
    "promise-to-callback": "^1.0.0",
    "prop-types": "^15.6.1",
    "pubnub": "4.24.4",
    "pump": "^3.0.0",
    "punycode": "^2.1.1",
    "qrcode-generator": "1.4.1",
    "ramda": "^0.24.1",
    "react": "^15.6.2",
    "react-dnd": "^3.0.2",
    "react-dnd-html5-backend": "^7.4.4",
    "react-dom": "^15.6.2",
    "react-hyperscript": "^3.0.0",
    "react-idle-timer": "^4.2.5",
    "react-inspector": "^2.3.0",
    "react-media": "^1.8.0",
    "react-redux": "^5.0.5",
    "react-router-dom": "^4.2.2",
    "react-select": "^1.0.0",
    "react-simple-file-input": "^2.0.0",
    "react-tippy": "^1.2.2",
    "react-toggle-button": "^2.2.0",
    "react-tooltip-component": "^0.3.0",
    "react-transition-group": "^1.2.1",
    "react-trigger-change": "^1.0.2",
    "reactify": "^1.1.1",
    "readable-stream": "^2.3.3",
    "recompose": "^0.25.0",
    "redux": "^3.0.5",
    "redux-logger": "^3.0.6",
    "redux-thunk": "^2.2.0",
    "request-promise": "^4.2.1",
    "reselect": "^3.0.1",
    "safe-event-emitter": "^1.0.1",
    "single-call-balance-checker-abi": "^1.0.0",
    "string.prototype.matchall": "^3.0.1",
    "swappable-obj-proxy": "^1.1.0",
    "textarea-caret": "^3.0.1",
    "valid-url": "^1.0.9",
    "web3": "^0.20.7",
    "web3-stream-provider": "^4.0.0",
    "webrtc-adapter": "^6.3.0",
    "xtend": "^4.0.1"
  },
  "devDependencies": {
    "@babel/core": "^7.5.5",
    "@babel/plugin-proposal-class-properties": "^7.5.5",
    "@babel/plugin-proposal-object-rest-spread": "^7.5.5",
    "@babel/plugin-transform-runtime": "^7.5.5",
    "@babel/preset-env": "^7.5.5",
    "@babel/preset-react": "^7.0.0",
    "@babel/register": "^7.5.5",
    "@sentry/cli": "^1.30.3",
    "@storybook/addon-info": "^5.1.1",
    "@storybook/addon-knobs": "^3.4.2",
    "@storybook/react": "^5.1.1",
    "addons-linter": "1.14.0",
    "babel-eslint": "^10.0.2",
    "babelify": "^10.0.0",
    "brfs": "^1.6.1",
    "browserify": "^16.2.3",
    "browserify-transform-tools": "^1.7.0",
    "chai": "^4.1.0",
    "chromedriver": "^2.41.0",
    "concurrently": "^4.1.1",
    "coveralls": "^3.0.0",
    "cross-env": "^5.1.4",
    "css-loader": "^2.1.1",
    "del": "^3.0.0",
    "deps-dump": "^1.1.0",
    "envify": "^4.0.0",
    "enzyme": "^3.4.4",
    "enzyme-adapter-react-15": "^1.0.6",
    "eslint": "^6.0.1",
    "eslint-plugin-chai": "0.0.1",
    "eslint-plugin-json": "^1.2.0",
    "eslint-plugin-mocha": "^5.0.0",
    "eslint-plugin-react": "^7.4.0",
    "fetch-mock": "^6.5.2",
    "file-loader": "^1.1.11",
    "fs-extra": "^6.0.1",
    "fs-promise": "^2.0.3",
    "ganache-cli": "^6.4.4",
    "ganache-core": "2.8.0",
    "geckodriver": "^1.16.2",
    "gh-pages": "^1.2.0",
    "gulp": "^4.0.0",
    "gulp-autoprefixer": "^5.0.0",
    "gulp-babel": "^7.0.0",
    "gulp-debug": "^3.2.0",
    "gulp-eslint": "^4.0.0",
    "gulp-imagemin": "^6.1.0",
    "gulp-json-editor": "^2.2.1",
    "gulp-livereload": "4.0.0",
    "gulp-multi-process": "^1.3.1",
    "gulp-rename": "^1.4.0",
    "gulp-replace": "^0.6.1",
    "gulp-rtlcss": "^1.4.0",
    "gulp-sass": "^4.0.0",
    "gulp-sourcemaps": "^2.6.0",
    "gulp-stylelint": "^7.0.0",
    "gulp-terser-js": "^5.0.0",
    "gulp-util": "^3.0.7",
    "gulp-watch": "^5.0.1",
    "gulp-zip": "^4.0.0",
    "http-server": "^0.11.1",
    "isomorphic-fetch": "^2.2.1",
    "jsdoc": "^3.6.2",
    "jsdom": "^11.2.0",
    "jsdom-global": "^3.0.2",
    "karma": "^4.1.0",
    "karma-chrome-launcher": "^2.2.0",
    "karma-cli": "^1.0.1",
    "karma-firefox-launcher": "^1.0.1",
    "karma-qunit": "^1.2.1",
    "lodash.assign": "^4.0.6",
    "mocha": "^5.0.0",
    "mocha-eslint": "^4.0.0",
    "mocha-jsdom": "^1.1.0",
    "mocha-sinon": "^2.0.0",
    "nock": "^9.0.14",
    "node-sass": "^4.12.0",
    "nyc": "^13.0.0",
    "path": "^0.12.7",
    "prepend-file": "^1.3.1",
    "proxyquire": "2.0.1",
    "qs": "^6.2.0",
    "qunitjs": "^2.4.1",
    "radgrad-jsdoc-template": "^1.1.3",
    "react-devtools": "^3.6.1",
    "react-test-renderer": "^15.6.2",
    "read-installed": "^4.0.3",
    "redux-mock-store": "^1.5.3",
    "redux-test-utils": "^0.2.2",
    "remote-redux-devtools": "^0.5.16",
    "remotedev-server": "^0.3.1",
    "resolve-url-loader": "^2.3.0",
    "rimraf": "^2.6.2",
    "sass-loader": "^7.0.1",
    "selenium-webdriver": "^3.5.0",
    "sesify": "^4.2.1",
    "sesify-viz": "^3.0.5",
    "sinon": "^5.0.0",
    "source-map": "^0.7.2",
    "source-map-explorer": "^2.0.1",
    "static-server": "^2.2.1",
    "style-loader": "^0.21.0",
    "stylelint": "^9.10.1",
    "stylelint-config-standard": "^18.2.0",
    "testem": "^2.16.0",
    "through2": "^2.0.3",
    "vinyl-buffer": "^1.0.1",
    "vinyl-source-stream": "^2.0.0",
    "watchify": "^3.11.1"
  },
  "engines": {
    // 注意：Node 和 Yarn 版本
    "node": "^10.16.0",
    "yarn": "^1.16.0"
  }
}
   ]]>
    </c:sourceContent>

    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:0.85em;line-height:1em;font-family:monospace;">
      <![CDATA[
<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 构建相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>@babel/runtime</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">babel 相关</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>browserify-derequire</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">
Browserify plugin for renaming require() calls in the output bundle. <br />
<a href="https://github.com/rse/browserify-derequire">https://github.com/rse/browserify-derequire</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 日志相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>@sentry/browser</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Sentry SDK for Browsers  错误记录 <br />
<a href="https://sentry.io">https://sentry.io</a> <br />
<a href="https://github.com/getsentry/sentry-javascript">https://github.com/getsentry/sentry-javascript</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>loglevel</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Minimal lightweight logging for JavaScript, adding reliable log level methods to wrap any available console.log methods <br />
<a href="https://github.com/pimterry/loglevel">https://github.com/pimterry/loglevel</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 二维码</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>@zxing/library</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">1/2维码库 <br />
<a href="https://github.com/zxing-js/library">https://github.com/zxing-js/library</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>qrcode-generator</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">QR Code Generator implementation in JavaScript, Java and more.<br />
<a href="https://github.com/kazuhikoarase/qrcode-generator">https://github.com/kazuhikoarase/qrcode-generator</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 加密相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>asmcrypto.js</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">JavaScript Cryptographic Library 性能比较好<br />
<a href="https://github.com/asmcrypto/asmcrypto.js">https://github.com/asmcrypto/asmcrypto.js</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>await-semaphore</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Awaitable semaphore/mutex js 信号量控制实现<br />
<a href="https://github.com/notenoughneon/await-semaphore">https://github.com/notenoughneon/await-semaphore</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>browser-passworder</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple browserifiable module for encrypting and decrypting JSON-serializable objects with a password. AES-GCM algorithm: <br />
<a href="https://github.com/danfinlay/browser-passworder">https://github.com/danfinlay/browser-passworder</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>multihashes</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">multihash implementation in JavaScript 同样的 hash，不同的算法生成，为未来扩展<br />
<a href="https://github.com/multiformats/js-multihash">https://github.com/multiformats/js-multihash</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 大数处理</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>bignumber.js</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A JavaScript library for arbitrary-precision decimal and non-decimal arithmetic
高精度数字处理，注意数字格式 Number, String or BigNumber<br />
<a href="https://github.com/MikeMcl/bignumber.js">https://github.com/MikeMcl/bignumber.js</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>bn.js</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">BigNum in pure javascript 处理大数的计算<br />
<a href="https://github.com/indutny/bn.js">https://github.com/indutny/bn.js</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>number-to-bn</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Converts a number to a BN.js object, throw if invalid number.<br />
<a href="https://github.com/SilentCicero/number-to-bn">https://github.com/SilentCicero/number-to-bn</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; bluebird 相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>bluebird</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">full featured promise library with unmatched performance<br />
<a href="https://github.com/petkaantonov/bluebird">https://github.com/petkaantonov/bluebird</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>request-promise</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">The simplified HTTP request client 'request' with Promise support. Powered by Bluebird.<br />
<a href="https://github.com/request/request-promise">https://github.com/request/request-promise</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>promise-filter</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Filter an array and return a Promise 和 bluebird.filter 一样<br />
<a href="https://github.com/yoshuawuyts/promise-filter">https://github.com/yoshuawuyts/promise-filter</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; JS基础功能增强</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>clone</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">deeply clone arbitrary objects in javascript<br />
<a href="https://github.com/pvorb/clone">https://github.com/pvorb/clone</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>debounce</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">防抖的一个实现<br />
<a href="https://github.com/component/debounce">https://github.com/component/debounce</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>debounce-stream</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Debounces a stream. 用户输入流去抖<br />
<a href="https://github.com/fardog/debounce-stream">https://github.com/fardog/debounce-stream</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>deep-extend</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Recursive extend module 递归扩展 obj 属性<br />
<a href="https://github.com/unclechu/node-deep-extend">https://github.com/unclechu/node-deep-extend</a>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>deep-freeze-strict</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">recursively Object.freeze() on objects and functions<br />
<a href="https://github.com/jsdf/deep-freeze">https://github.com/jsdf/deep-freeze</a>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>lodash.debounce</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">The lodash method _.debounce<br />
<a href="https://github.com/lodash/lodash">https://github.com/lodash/lodash</a>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>lodash.shuffle</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">The lodash method _.shuffle<br />
<a href="https://github.com/lodash/lodash">https://github.com/lodash/lodash</a>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>xtend</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">xtend is a basic utility library which allows you to extend an object by appending all of the properties from each object in a list.<br />
<a href="https://github.com/Raynos/xtend">https://github.com/Raynos/xtend</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; JSON增强</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>fast-json-patch</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Lean and mean Javascript implementation of the JSON-Patch standard (RFC 6902). Update JSON documents using delta patches.<br />
<a href="https://github.com/Starcounter-Jack/JSON-Patch">https://github.com/Starcounter-Jack/JSON-Patch</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>jsonschema</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">JSON Schema validation 校验 json 文档<br />
<a href="https://github.com/tdegrunt/jsonschema">https://github.com/tdegrunt/jsonschema</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; RPC相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>dnode</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">turtles all the way down rpc RPC调用<br />
<a href="https://github.com/substack/dnode">https://github.com/substack/dnode</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>json-rpc-engine -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">a tool for processing JSON RPC<br />
<a href="https://github.com/MetaMask/json-rpc-engine">https://github.com/MetaMask/json-rpc-engine</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>json-rpc-middleware-stream -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A small toolset for streaming json rpc and matching requests and responses. Made to be used with json-rpc-engine.
metamask 封装了很多 stream 操作<br />
<a href="https://github.com/MetaMask/json-rpc-middleware-stream">https://github.com/MetaMask/json-rpc-middleware-stream</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; Shim / polyfill</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>abortcontroller-polyfill</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Polyfill for the AbortController DOM API and abortable fetch 中止fetch<br />
<a href="https://github.com/mo/abortcontroller-polyfill">https://github.com/mo/abortcontroller-polyfill</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>polyfill-crypto.getrandomvalues</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">This is a polyfill for window.crypto.getRandomValues() .<br />
<a href="https://github.com/kumavis/polyfill-crypto.getrandomvalues">https://github.com/kumavis/polyfill-crypto.getrandomvalues</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>string.prototype.matchall</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Spec-compliant polyfill for String.prototype.matchAll ESnext proposal.<br />
<a href="https://github.com/ljharb/String.prototype.matchAll">https://github.com/ljharb/String.prototype.matchAll</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; WebRTC</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>detectrtc</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">detect WebRTC features e.g. system having speakers, microphone or webcam, screen capturing is supported, number of audio/video devices etc.<br />
<a href="https://github.com/muaz-khan/DetectRTC">https://github.com/muaz-khan/DetectRTC</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>webrtc-adapter</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">adapter.js is a shim to insulate apps from spec changes and prefix differences.<br />
<a href="https://github.com/webrtchacks/adapter">https://github.com/webrtchacks/adapter</a>
</p>

<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; Stream 相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>end-of-stream</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A node module that calls a callback when a readable/writable/duplex stream has completed or failed.<br />
<a href="https://github.com/mafintosh/end-of-stream">https://github.com/mafintosh/end-of-stream</a>
</p>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;">
// Usage
var eos = require('end-of-stream');

eos(readableStream, function(err) {
  // this will be set to the stream instance
  if (err) return console.log('stream had an error or closed early');
  console.log('stream has ended', this === readableStream);
});

eos(writableStream, function(err) {
  if (err) return console.log('stream had an error or closed early');
  console.log('stream has finished', this === writableStream);
});

eos(duplexStream, function(err) {
  if (err) return console.log('stream had an error or closed early');
  console.log('stream has ended and finished', this === duplexStream);
});

eos(duplexStream, {readable:false}, function(err) {
  if (err) return console.log('stream had an error or closed early');
  console.log('stream has finished but might still be readable');
});

eos(duplexStream, {writable:false}, function(err) {
  if (err) return console.log('stream had an error or closed early');
  console.log('stream has ended but might still be writable');
});

eos(readableStream, {error:false}, function(err) {
  // do not treat emit('error', err) as a end-of-stream
});
</pre>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>extension-port-stream -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A module for creating a node style stream over a WebExtension port object.<br />
<a href="https://github.com/MetaMask/extension-port-stream">https://github.com/MetaMask/extension-port-stream</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>obj-multiplex</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">simple stream multiplexing for objectMode  多路复用<br />
其实就是一个多路复用流能够使用name来区分各个子流，以达到一个parent流下其实有多个子流在运行，可以通过多个子流来读入写出数据，效率更高。而且parent流结束了，则所有子流也会被销毁<br />
<a href="https://github.com/kumavis/obj-multiplex">https://github.com/kumavis/obj-multiplex</a><br />
<a href="https://github.com/zoubin/streamify-your-node-program/blob/master/docs/objectMode.md">https://github.com/zoubin/streamify-your-node-program/blob/master/docs/objectMode.md</a>
</p>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;">
// usage
// create multiplexer
const mux = new ObjMultiplex()

// setup substreams
const streamA = mux.createStream('hello')
const streamB = mux.createStream('world')

// pipe over transport (and back)
mux.pipe(transport).pipe(mux)

// send values over the substreams
streamA.write({ thisIsAn: 'object' })
streamA.write(123)

// or pipe together normally
streamB.pipe(evilAiBrain).pipe(streamB)
</pre>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>pump</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">pipe streams together and close all of them if one of them closes<br />
<a href="https://github.com/mafintosh/pump">https://github.com/mafintosh/pump</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>readable-stream</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Node-core streams for userland<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/nodejs/readable-stream</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 其他工具库</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>copy-to-clipboard</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Copy stuff into clipboard from your browser using JS<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/sudodoki/copy-to-clipboard</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>currency-formatter</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple Javascript utility that helps you to display currency properly<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/smirzaei/currency-formatter</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>detect-node</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Detect Node.JS 就是看看有没有定义process属性<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/iliakan/detect-node</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>extensionizer -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A JS module for writing cross-browser extensions.
把各浏览器的一些隐藏 API 实现暴露出来<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/MetaMask/extensionizer</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>fuse.js</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Lightweight fuzzy-search, in JavaScript https://fusejs.io/<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/krisk/Fuse</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>browserify-unibabel</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple browserify style version of Unibabel<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/Daplie/unibabel-js</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>luxon</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A library for working with dates and times in JS moment的一个替代品<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/moment/luxon</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>mkdirp</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Recursively mkdir, like `mkdir -p`, but in node.js<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/substack/node-mkdirp</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>obs-store -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">ObservableStore is a synchronous in-memory store for a single value, that you can subscribe to updates on.<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/MetaMask/obs-store</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>percentile</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Calculate percentile for given array of values<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/d4rkr00t/percentile</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>post-message-stream</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Sets up a duplex object stream over window.postMessage<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/kumavis/post-message-stream</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>pify</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Promisify a callback-style function<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/sindresorhus/pify</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>promise-to-callback</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Convert promise to callback interface 和 pify 相反<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/stevemao/promise-to-callback</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>pubnub</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">PubNub JavaScript SDK https://www.pubnub.com/<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/pubnub/javascript</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ramda</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A practical functional library for JavaScript programmers.<br />
<a href="https://github.com/nodejs/readable-stream">https://github.com/ramda/ramda</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>safe-event-emitter -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">An EventEmitter that isolates the emitter from errors in handlers. If an error is thrown in a handler it is caught and re-thrown inside of a setTimeout so as to not interupt the emitter's code flow. 
如果在处理程序中抛出错误，就会被捕获并在setTimeout中重新抛出，以便不会中断发射器的代码流<br />
<a href="https://github.com/MetaMask/safe-event-emitter">https://github.com/MetaMask/safe-event-emitter</a>
</p>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;">
// usage
const SafeEventEmitter = require('safe-event-emitter')

const ee = new SafeEventEmitter()
ee.on('boom', () => { throw new Error() })
ee.emit('boom') // no error here

// error is thrown after setTimeout
</pre>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;">
// 源码分析
const util = require('util')
const EventEmitter = require('events/')

var R = typeof Reflect === 'object' ? Reflect : null
// 定义 ReflectApply，对一个函数进行调用操作 http://es6.ruanyifeng.com/#docs/reflect
var ReflectApply = R && typeof R.apply === 'function'
  ? R.apply
  : function ReflectApply(target, receiver, args) {
    return Function.prototype.apply.call(target, receiver, args);
}

module.exports = SafeEventEmitter


function SafeEventEmitter() {
  EventEmitter.call(this)
}

util.inherits(SafeEventEmitter, EventEmitter)

SafeEventEmitter.prototype.emit = function (type) {
  // copied from https://github.com/Gozala/events/blob/master/events.js
  // modified lines are commented with "edited:"
  var args = [];
  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);
  var doError = (type === 'error');

  var events = this._events;
  if (events !== undefined)
    doError = (doError && events.error === undefined);
  else if (!doError)
    return false;

  // If there is no 'error' event listener then throw.
  if (doError) {
    var er;
    if (args.length > 0)
      er = args[0];
    if (er instanceof Error) {
      // Note: The comments on the `throw` lines are intentional, they show
      // up in Node's output if this results in an unhandled exception.
      throw er; // Unhandled 'error' event
    }
    // At least give some kind of context to the user
    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));
    err.context = er;
    throw err; // Unhandled 'error' event
  }

  var handler = events[type];

  if (handler === undefined)
    return false;

  if (typeof handler === 'function') {
    // edited: using safeApply, source: ReflectApply(handler, this, args)
    safeApply(handler, this, args);
  } else {
    var len = handler.length;
    var listeners = arrayClone(handler, len);
    for (var i = 0; i < len; ++i)
      // edited: using safeApply
      safeApply(listeners[i], this, args);
  }

  return true;
}

function safeApply(handler, context, args) {
  try {
    ReflectApply(handler, context, args)
  } catch (err) {
    // throw error after timeout so as not to interupt the stack
    setTimeout(() => {
      throw err
    })
  }
}

function arrayClone(arr, n) {
  var copy = new Array(n);
  for (var i = 0; i < n; ++i)
    copy[i] = arr[i];
  return copy;
}
</pre>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>swappable-obj-proxy</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Creates a Proxy around any object / EventEmitter.<br />
<a href="https://github.com/kumavis/swappable-obj-proxy">https://github.com/kumavis/swappable-obj-proxy</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>valid-url</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Node module that provides URI validation functions<br />
<a href="https://github.com/ogt/valid-url">https://github.com/ogt/valid-url</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 钱包相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>bip39</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">JavaScript implementation of Bitcoin BIP39: Mnemonic code for generating deterministic keys<br />
如果对个人隐私比较注重，就需要为每一次交易生成一个新的地址，仅需要记住助记词便可保证拥有对所有地址的操作权。<br />
<a href="https://github.com/bitcoinjs/bip39">https://github.com/bitcoinjs/bip39</a><br />
<a href="https://github.com/bitcoin/bips/blob/master/bip-0039/bip-0039-wordlists.md">https://github.com/bitcoin/bips/blob/master/bip-0039/bip-0039-wordlists.md</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-keyring-controller -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A module for managing groups of Ethereum accounts called "Keyrings", defined originally for MetaMask's multiple-account-type feature.<br />
<a href="https://github.com/MetaMask/KeyringController">https://github.com/MetaMask/KeyringController</a><br />
<a href="https://github.com/MetaMask/eth-simple-keyring">https://github.com/MetaMask/eth-simple-keyring</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-ledger-bridge-keyring -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A javascript wrapper around LedgerJS libraries, to support the KeyringController protocol used by MetaMask<br />
<a href="https://github.com/MetaMask/KeyringController">https://github.com/MetaMask/eth-ledger-bridge-keyring</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-sig-util -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A collection of functions for signing and verifying data with Ethereum keys.<br />
<a href="https://github.com/MetaMask/eth-sig-util">https://github.com/MetaMask/eth-sig-util</a><br />
例子：<a href="https://github.com/danfinlay/js-eth-personal-sign-examples">https://github.com/danfinlay/js-eth-personal-sign-examples</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-token-tracker -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A JS module for tracking Ethereum token balances over block changes. 轮询查余额<br />
<a href="https://github.com/MetaMask/eth-token-tracker">https://github.com/MetaMask/eth-token-tracker</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-trezor-keyring -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A javascript wrapper around Trezor Connect javascript libraries, to support the KeyringController protocol used by MetaMask Trezor硬件钱包<br />
<a href="https://github.com/metamask/eth-trezor-keyring">https://github.com/metamask/eth-trezor-keyring</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethereumjs-tx</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple module for creating, manipulating and signing ethereum transactions 签名交易, 用于 web3 的 sendRawTransaction<br />
<a href="https://github.com/ethereumjs/ethereumjs-tx">https://github.com/ethereumjs/ethereumjs-tx</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethereumjs-util</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A collection of utility functions for Ethereum 一些 eth 用到的工具方法<br />
<a href="https://github.com/ethereumjs/ethereumjs-util">https://github.com/ethereumjs/ethereumjs-util</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethereumjs-wallet</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Utilities for handling Ethereum keys 产生和管理公私钥<br />
HD Wallet: var hdkey = require('ethereumjs-wallet/hdkey')<br />
<a href="https://github.com/ethereumjs/ethereumjs-wallet">https://github.com/ethereumjs/ethereumjs-wallet</a>
</p>
<ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;font-size: 1.5em;line-height: 1.325em;">
  <li>ethereumjs-tx 签名交易</li>
  <li>ethereumjs-util 工具方法</li>
  <li>ethereumjs-wallet 管理公私钥</li>
  <li>web3 发送交易</li>
</ul>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>gaba -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Collection of platform-agnostic modules for creating secure data models for cryptocurrency wallets
<br />
<a href="https://github.com/MetaMask/gaba">https://github.com/MetaMask/gaba</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>metamask-inpage-provider</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">An ethereum provider that connects over a stream, as injected into websites by MetaMask.
Used to initialize the inpage ethereum provider injected by MetaMask.<br />
这个库的作用有设置浏览器本地信息存储publicConfig流、构建RpcProvider双向传送json rpc及其结果流，以及对从浏览器中得到的json rpc进行处理，send/sendsync的处理是不同的，然后将他们根据得到的特殊id存储到数组中，等待传送到区块链进行处理。<br />
<a href="https://github.com/MetaMask/metamask-inpage-provider/blob/master/index.js">https://github.com/MetaMask/metamask-inpage-provider/blob/master/index.js</a><br />
<a href="https://github.com/MetaMask/metamask-inpage-provider">metamask 自有库
: https://github.com/MetaMask/metamask-inpage-provider</a>
</p>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;">
// usage
// Create a stream to a remote provider:
var metamaskStream = new LocalMessageDuplexStream({
  name: 'inpage',
  target: 'contentscript',
})

// compose the inpage provider
var inpageProvider = new MetamaskInpageProvider(metamaskStream)
</pre>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>nonce-tracker -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">How metamask calculates nonces<br />
<a href="https://github.com/MetaMask/nonce-tracker">https://github.com/MetaMask/nonce-tracker</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 合约相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>abi-decoder</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Nodejs and Javascript library for decoding data params and events from etherem transactions<br />
<a href="https://github.com/ConsenSys/abi-decoder">https://github.com/ConsenSys/abi-decoder</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-contract-metadata -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A mapping of ethereum contract addresses to broadly accepted icons for those addresses. 合约和图标映射<br />
<a href="https://github.com/MetaMask/eth-contract-metadata">https://github.com/MetaMask/eth-contract-metadata</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-method-registry -- metamask 自有库</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A javascript library for getting Solidity method data from a four-byte method signature.<br />
<a href="https://github.com/MetaMask/nonce-tracker">https://github.com/MetaMask/eth-method-registry</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-query</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">minimal rpc wrapper<br />
<a href="https://github.com/ethereumjs/eth-query">https://github.com/ethereumjs/eth-query</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethereumjs-abi</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Decoder and encoder for the Ethereum ABI<br />
<a href="https://github.com/ethereumjs/ethereumjs-abi">https://github.com/ethereumjs/ethereumjs-abi</a>
</p>
<div>
  <img src="/images/ether/1576745460249-8e0eaa4a-0392-4e50-8f67-654577204111.png" />
</div>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethjs-contract</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple contract object for the Ethereum RPC layer.<br />
<a href="https://github.com/ethjs/ethjs-contract">https://github.com/ethjs/ethjs-contract</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>human-standard-token-abi</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A JSON ABI for the Ethereum ERC 20 Token Standard , ERC 20 Token 的 abi<br />
<a href="https://github.com/danfinlay/human-standard-token-abi">https://github.com/danfinlay/human-standard-token-abi</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>single-call-balance-checker-abi</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple node module that exports the [Ethereum ABI] for eth-balance-checker smart contract<br />
<a href="https://etherscan.io/address/0xb1f8e55c7f64d203c1400b9d8555d050f94adf39#code">https://etherscan.io/address/0xb1f8e55c7f64d203c1400b9d8555d050f94adf39#code</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; RPC相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-block-tracker</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A JS module for keeping track of the latest Ethereum block by polling an ethereum provider.<br />
<a href="https://github.com/MetaMask/eth-block-tracker">https://github.com/MetaMask/eth-block-tracker</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-json-rpc-errors</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Errors for JSON RPC 2.0 and ETH JSON RPC.<br />
<a href="https://github.com/MetaMask/eth-json-rpc-errors">https://github.com/MetaMask/eth-json-rpc-errors</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-json-rpc-filters</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">json-rpc-engine middleware implementing ethereum filter methods eth的过滤器实现，接收事件通知<br />
<a href="https://github.com/MetaMask/eth-json-rpc-filters">https://github.com/MetaMask/eth-json-rpc-filters</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-json-rpc-infura</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">json-rpc-engine middleware for infura's REST endpoints.
metamask 利用 infura 的节点来广播交易<br />
https://infura.io/ infura 用于 dApp 快速接入以太坊<br />
<a href="https://github.com/MetaMask/eth-json-rpc-infura">https://github.com/MetaMask/eth-json-rpc-infura</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-json-rpc-middleware</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Ethereum middleware for composing an ethereum provider using json-rpc-engine. Intended to replace provider-engine.<br />
<a href="https://github.com/MetaMask/eth-json-rpc-middleware">https://github.com/MetaMask/eth-json-rpc-middleware</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethjs</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A highly optimised, light-weight JS utility for Ethereum.
web3 的一个替代品，还有个类似的是 ethers.js<br />
<a href="https://github.com/ethjs/ethjs">https://github.com/ethjs/ethjs</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethjs-query</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple query module for the Ethereum RPC.<br />
<a href="https://github.com/ethjs/ethjs-query">https://github.com/ethjs/ethjs-query</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>web3</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Ethereum JavaScript API
metamask 用的是 0.20.7 版本，未来有改进计划<br />
<a href="https://github.com/ethereum/web3.js">https://github.com/ethereum/web3.js</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>web3-stream-provider</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">creates an Ethereum web3 provider that forwards payloads through a stream<br />
<a href="https://github.com/kumavis/web3-stream-provider">https://github.com/kumavis/web3-stream-provider</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; ENS相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>content-hash</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">simple tool to encode/decode content hash for EIP 1577 compliant ENS Resolvers<br />
参考：https://learnblockchain.cn/docs/ens/contract-api-reference/publicresolver.html#%E8%8E%B7%E5%8F%96%E5%86%85%E5%AE%B9%E6%95%A3%E5%88%97<br />
<a href="https://github.com/pldespaigne/content-hash">https://github.com/pldespaigne/content-hash</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-ens-namehash</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A javascript library for generating Ethereum Name Service (ENS) namehashes per spec.<br />
<a href="https://github.com/danfinlay/eth-ens-namehash">https://github.com/danfinlay/eth-ens-namehash</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>ethjs-ens</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">An Ethereum Name Service interface module built on EthJS<br />
<a href="https://github.com/ethjs/ethjs-ens">https://github.com/ethjs/ethjs-ens</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 其他</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>3box</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">set, get, and remove private and public data associated with an ethereum account<br />
<a href="https://github.com/3box/3box-js">https://github.com/3box/3box-js</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>eth-phishing-detect</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Utility for detecting phishing domains targeting Ethereum users 钓鱼网站检测<br />
<a href="https://github.com/MetaMask/eth-phishing-detect">https://github.com/MetaMask/eth-phishing-detect</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>etherscan-link</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A library for generating etherscan links.<br />
<a href="https://github.com/MetaMask/etherscan-link">https://github.com/MetaMask/etherscan-link</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>metamask-logo</b> -- metamask 自有库</h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A 3d take on the metamask logo, in browser, as a browserifyable module.<br />
<a href="https://github.com/MetaMask/metamask-logo">https://github.com/MetaMask/metamask-logo</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 通用UI库</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>@material-ui/core</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">React components that implement Google's Material Design.<br />
<a href="https://github.com/mui-org/material-ui">https://github.com/mui-org/material-ui</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>d3</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Bring data to life with SVG, Canvas and HTML. https://d3js.org<br />
<a href="https://github.com/d3/d3">https://github.com/d3/d3</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>c3</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A D3-based reusable chart library. http://c3js.org<br />
<a href="https://github.com/c3js/c3">https://github.com/c3js/c3</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>jazzicon</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Jazzy deterministic identicons for a more entertaining future. 生成五颜六色头像图标<br />
<a href="https://github.com/flyswatter/jazzicon">https://github.com/flyswatter/jazzicon</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>textarea-caret</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">xy coordinates of a textarea or input's caret<br />
<a href="https://github.com/component/textarea-caret-position">https://github.com/component/textarea-caret-position</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; React 相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">
<a href="https://github.com/facebook/react">https://github.com/facebook/react</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-dom</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">This package serves as the entry point to the DOM and server renderers for React.</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>classnames</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A simple javascript utility for conditionally joining classNames together<br />
<a href="https://github.com/JedWatson/classnames">https://github.com/JedWatson/classnames</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>prop-types</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Runtime type checking for React props and similar objects<br />
<a href="https://github.com/facebook/prop-types">https://github.com/facebook/prop-types</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-hyperscript</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Hyperscript syntax for React.js markup. <br />
<a href="https://github.com/mlmorg/react-hyperscript">https://github.com/mlmorg/react-hyperscript</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-idle-timer</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">User activity timer component 检测用户是否发呆<br />
<a href="https://github.com/supremetechnopriest/react-idle-timer">https://github.com/supremetechnopriest/react-idle-timer</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-inspector</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Power of Browser DevTools inspectors right inside your React app<br />
<a href="https://github.com/xyc/react-inspector">https://github.com/xyc/react-inspector</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-media</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">CSS media queries for React<br />
<a href="https://github.com/ReactTraining/react-media">https://github.com/ReactTraining/react-media</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-router-dom</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Declarative routing for React<br />
<a href="https://github.com/ReactTraining/react-router">https://github.com/ReactTraining/react-router</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-trigger-change</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Trigger React's synthetic change events on input, textarea and select elements 主要用来测试<br />
<a href="https://github.com/vitalyq/react-trigger-change">https://github.com/vitalyq/react-trigger-change</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>reactify [DEPRECATED]</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">[DEPRECATED] Browserify transform for JSX (superset of JavaScript used in React library by Facebook)<br />
<a href="https://github.com/andreypopp/reactify">https://github.com/andreypopp/reactify</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>recompose</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A React utility belt for function components and higher-order components.
react 的 lodash<br />
<a href="https://github.com/acdlite/recompose">https://github.com/acdlite/recompose</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; React UI 组件</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>boron</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A collection of dialog animations with React.js<br />
<a href="https://github.com/yuanyan/boron">https://github.com/yuanyan/boron</a>
</p>


<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-dnd</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Drag and Drop for React  <br />
<a href="https://github.com/react-dnd/react-dnd">https://github.com/react-dnd/react-dnd</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-dnd-html5-backend</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">The officially supported HTML5 backend for React DnD.</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-select</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">The Select Component for React.js https://react-select.com/home<br />
<a href="https://github.com/JedWatson/react-select">https://github.com/JedWatson/react-select</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-simple-file-input</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Simple wrapper for the HTML input tag and HTML5 FileReader API<br />
<a href="https://github.com/greena13/react-simple-file-input">https://github.com/greena13/react-simple-file-input</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-tippy</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">A lightweight tooltip for React.<br />
<a href="https://github.com/tvkhoa/react-tippy">https://github.com/tvkhoa/react-tippy</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-toggle-button</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">It's a toggle button<br />
<a href="https://github.com/gdowens/react-toggle-button">https://github.com/gdowens/react-toggle-button</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-tooltip-component</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">React tooltip component.<br />
<a href="https://github.com/minhtranite/react-tooltip-component">https://github.com/minhtranite/react-tooltip-component</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-transition-group</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">An easy way to perform animations when a React component enters or leaves the DOM<br />
<a href="https://github.com/reactjs/react-transition-group">https://github.com/reactjs/react-transition-group</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; Redux相关</h2>
<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>react-redux</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Official React bindings for Redux<br />
<a href="https://github.com/reduxjs/react-redux">https://github.com/reduxjs/react-redux</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>redux</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Predictable state container for JavaScript apps<br />
<a href="https://github.com/reduxjs/redux">https://github.com/reduxjs/redux</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>redux-logger</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Logger for Redux<br />
<a href="https://github.com/LogRocket/redux-logger">https://github.com/LogRocket/redux-logger</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>redux-thunk</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Thunk middleware for Redux<br />
<a href="https://github.com/reduxjs/redux-thunk">https://github.com/reduxjs/redux-thunk</a>
</p>

<h3 style="font-size: 1.325em;padding-bottom: 0;color: brown;"><b>reselect</b></h3>
<p style="font-size: 1.325em;line-height: 1.625em;">Selector library for Redux<br />
<a href="https://github.com/reduxjs/reselect">https://github.com/reduxjs/reselect</a>
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; ETH测试</h2>
<p style="font-size: 1.325em;line-height: 1.625em;">ganache-cli: <a href="https://www.trufflesuite.com/ganache">https://www.trufflesuite.com/ganache</a> Ganache 是一个为开发者提供的私有 Ethereum 区块链客户端, 可以用于本地部署, 开发, 测试应用程序, 测试代码.
ganache-core
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 增强</h2>
<p style="font-size: 1.325em;line-height: 1.625em;">
<b>fs-extra:</b> fs-extra adds file system methods that aren't included in the native fs module and adds promise support to the fs methods.<br />
<b>fs-promise[DEPRECATED]</b> <br />
<b>lodash.assign:</b> The lodash method _.assign exported as a Node.js module.<br />
<b>path:</b> This is an exact copy of the NodeJS ’path’ module published to the NPM registry.<br />
<b>prepend-file:</b> Prepend data to a file, creating the file if it not yet exists.<br />
<b>qs:</b> A querystring parsing and stringifying library with some added security.
</p>


<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; 其他</h2>
<p style="font-size: 1.325em;line-height: 1.625em;">
<b>@sentry/cli</b><br />
<b>gh-pages:</b> Publish files to a gh-pages branch on GitHub<br />
<b>http-server:</b> a command-line http server<br />
<b>jsdoc:</b> An API documentation generator for JavaScript.<br />
<b>radgrad-jsdoc-template:</b> A Semantic UI documentation template theme for JSDoc 3.<br />
<b>read-installed:</b> Read all the installed packages in a folder, and return a tree structure with all the data.<br />
<b>source-map</b><br />
<b>source-map-explorer</b><br />
<b>static-server:</b> A simple http server to serve static resource files from a local directory.
</p>
   ]]>
    </c:sourceContent>
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>


  <c:entry style="margin-top:1em;">
    <c:title id="3box"><![CDATA[<div style="color:blue;font-size:1.625em;">3box</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.425em;">
  https://github.com/3box/3box-js
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-bottom:.425em;">
  3box 可让您设置，获取和删除与以太坊账户相关的私人和公共数据。使用启用了Web3的浏览器的dapp可以使用它存储身份数据，用户设置等。只要用户可以访问已使用的以太坊账户的私钥，就可以检索数据。数据已加密，未经用户授权的任何第三方都无法读取。默认情况下，所有授权的dapp都有一个共享的数据空间，然后dapp必须请求明确同意访问这些空间。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1.425em;background-color:white;margin-top:.25em;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.25em;font-family:monospace;">
      <![CDATA[
const profile = await Box.getProfile('0x12345abcde')
console.log(profile)
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1.425em;background-color:white;margin-top:.25em;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.25em;font-family:monospace;">
      <![CDATA[
// 1. Create a 3Box instance
const box = await Box.create(provider)

// 2. Authenticate user
const address = '0x12345abcde'
const spaces = ['myDapp']
await box.auth(spaces, { address })

// 3. Sync user's available 3Box data from the network
await box.syncDone

// 4. Interact with 3Box profile data
// use the public profile
// get
const nickname = await box.public.get('name')
console.log(nickname)
// set
await box.public.set('name', 'oed')
// remove
await box.public.remove('name')

// use the private store
// get
const email = await box.private.get('email')
console.log(email)
// set
await box.private.set('email', 'oed@email.service')
// remove
await box.private.remove('email')

const fields = ['name', 'website', 'employer']
const values = ['Jon Schwartz', 'openworklabs.com', 'Open Work Labs']

await box.public.setMultiple(fields, values)

const privateFields = ['age', 'coinBalance']
const privateValues = ['xxx', 'yyy']

await box.private.setMultiple(privateFields, privateValues)
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>


  <c:entry style="margin-top:1em;">
    <c:title id="eth-block-tracker"><![CDATA[<div style="color:blue;font-size:1.625em;">eth-block-tracker</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.425em;">
  https://github.com/MetaMask/eth-block-tracker
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-bottom:.425em;">
  A JS module for keeping track of the latest Ethereum block by polling an ethereum provider.
通过拉取以太坊的provider来跟踪最新的以太坊区块
</div>
<div style="margin-bottom:.425em;">
  This module walks the Ethereum blockchain, keeping track of the latest block. It uses a web3 provider as a data source and will continuously poll for the next block.
使用web3 provider作为其数据源，并不停地从最新的区块中拉取数据
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1.425em;background-color:white;margin-top:.25em;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.25em;font-family:monospace;">
      <![CDATA[
const HttpProvider = require('ethjs-provider-http')
const PollingBlockTracker = require('eth-block-tracker')

const provider = new HttpProvider('https://mainnet.infura.io')
const blockTracker = new PollingBlockTracker({ provider })
blockTracker.on('latest', console.log)
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;color:green;font-size:1.425em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.25em;font-family:monospace;margin-top:.65em;">
      <![CDATA[

<h2 style="font-size: 1.625em;margin-top:.625em;">&diams; methods</h2>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;">
/**
 * creates a new block tracker with provider as a data source and
 * pollingInterval (ms) timeout between polling for the latest block.
 * If an Error is encountered when fetching blocks, it will wait retryTimeout (ms) before attempting again.
 * If keepEventLoopActive is false, in Node.js it will unref the polling timeout, allowing the process to exit during the polling interval. defaults to true, meaning the process will be kept alive.
 */

new PollingBlockTracker({ provider, pollingInterval, retryTimeout, keepEventLoopActive })
</pre>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
创建了一个指定 provider 数据源的区块追踪器，并在 pollingInterval 的间隔时间内拉取最新区块。当获取区块的时候如果出现了错误，那么她就会等待 retryTimeout (ms)再重新获取。如果 keepEventLoopActive 是 false，在 nodejs 中它会取消轮询超时，即在拉取的间隔中允许进程退出。默认是 true，意味着进程始终保持活跃
</div>

<h3 style="font-size: 1.425em;padding-bottom: 0;color: brown;"><b>getCurrentBlock()</b></h3>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
synchronous returns the current block. may be null. 同步获取当前的区块
</div>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;margin-bottom:.25em;">
console.log(blockTracker.getCurrentBlock())
</pre>

<h3 style="font-size: 1.425em;padding-bottom: 0;color: brown;"><b>async getLatestBlock()</b></h3>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
Asynchronously returns the latest block. 异步获取最新区块
if not immediately available, it will fetch one.
</div>

<h3 style="font-size: 1.425em;padding-bottom: 0;color: brown;"><b>async checkForLatestBlock()</b></h3>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
Tells the block tracker to ask for a new block immediately, in addition to its normal polling interval.
Useful if you received a hint of a new block (e.g. via tx.blockNumber from getTransactionByHash).
</div>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
Will resolve to the new latest block when its done polling.
要求区块追踪器马上去取新的区块，除非现在正处于正常的polling间隔。如果你收到了新的区块的暗示时这个功能就十分有用（via tx.blockNumber from getTransactionByHash）。当其拉取完后，将释放最新的区块
</div>

<h2 style="font-size: 1.625em;margin-top:.625em;padding-bottom: 0;">&diams; EVENTS</h2>
<h3 style="font-size: 1.425em;padding-bottom: 0;color: brown;"><b>latest</b></h3>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
The latest event is emitted for whenever a new latest block is detected.
This may mean skipping blocks if there were two created since the last polling period.
当新的区块被检测到时，这个事件就会被触发。如果在上一个拉取周期中生成了两个区块，那么将会跳过，不会触发事件
</div>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;margin-bottom:.25em;">
blockTracker.on('latest', (newBlock) => console.log(newBlock))
</pre>

<h3 style="font-size: 1.425em;padding-bottom: 0;color: brown;"><b>sync</b></h3>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
The sync event is emitted the same as "latest" but includes the previous block.
它跟"latest"是相同的，不同在与它还返回了之前的一个区块
</div>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;margin-bottom:.25em;">
blockTracker.on('sync', ({ newBlock, oldBlock }) => console.log(newBlock, oldBlock))
</pre>

<h3 style="font-size: 1.425em;padding-bottom: 0;color: brown;"><b>error</b></h3>
<div style="margin-top:.425em;font-size:1.1em;line-height:1.625em;">
The error event means an error occurred while polling for the latest block.
当拉取最新的区块的时候出现错误时触发
</div>
<pre style="background-color:darkblue;color:cadetblue;padding:.625em 1em;margin-top:.325em;margin-bottom:.25em;">
blockTracker.on('error', (err) => console.error(err))
</pre>
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>


  <c:entry style="margin-top:1em;">
    <c:title id="json-rpc-engine"><![CDATA[<div style="color:blue;font-size:1.625em;">json-rpc-engine</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.425em;">
  A tool for processing JSON RPC: https://github.com/MetaMask/json-rpc-engine
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="使用" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
const RpcEngine = require('json-rpc-engine')

let engine = new RpcEngine()

// Build a stack of json rpc processors by pushing in RpcEngine middleware.
engine.push(function(req, res, next, end){
  res.result = 42
  end()
})

// JSON RPC are handled asynchronously, stepping down the stack until complete.
let request = { id: 1, jsonrpc: '2.0', method: 'hello' }

engine.handle(request, function(err, res){
  // do something with res.result
})

// RpcEngine middleware has direct access to the request and response objects. It can let processing continue down the stack with next() or complete the request with end().
engine.push(function(req, res, next, end){
  if (req.skipCache) return next()
  res.result = getResultFromCache(req)
  end()
})

// By passing a 'return handler' to the next function, you can get a peek at the result before it returns.
engine.push(function(req, res, next, end){
  next(function(cb){
    insertIntoCache(res, cb)
  })
})

// RpcEngines can be nested by converting them to middleware asMiddleware(engine)
const asMiddleware = require('json-rpc-engine/lib/asMiddleware')

let engine = new RpcEngine()
let subengine = new RpcEngine()
engine.push(asMiddleware(subengine))
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="gotchas" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1.425em;background-color:white;margin-top:.25em;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.25em;font-family:monospace;">
      <![CDATA[
// Handle errors via end(err), NOT next(err).
// That said, next() will detect errors on the RPC response, and cause end(res.error) to be called.
/* INCORRECT */
engine.push(function(req, res, next, end){
  next(new Error())
})

/* CORRECT */
engine.push(function(req, res, next, end){
  end(new Error())
})
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>


  <c:entry style="margin-top:1em;">
    <c:title id="json-rpc-middleware-stream"><![CDATA[<div style="color:blue;font-size:1.625em;">json-rpc-middleware-stream</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  A small toolset for streaming json rpc and matching requests and responses. Made to be used with json-rpc-engine.
</div>
<div style="margin-bottom:.425em;font-size:1.225em;">
  可以用来与json-rpc-engine结合使用，对输入的json rpc进行读入、写出处理
</div>
<div style="margin-bottom:.425em;font-size:1.425em;">
  https://github.com/MetaMask/json-rpc-middleware-stream
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>


  <c:entry style="margin-top:1em;">
    <c:title id="metamask-inpage-provider"><![CDATA[<div style="color:blue;font-size:1.625em;">metamask-inpage-provider</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  Used to initialize the inpage ethereum provider injected by MetaMask.
</div>
<div style="margin-bottom:.425em;font-size:1.425em;">
  https://github.com/MetaMask/metamask-inpage-provider
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="使用" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
// Create a stream to a remote provider:
var metamaskStream = new LocalMessageDuplexStream({
  name: 'inpage',
  target: 'contentscript',
})

// compose the inpage provider
var inpageProvider = new MetamaskInpageProvider(metamaskStream)
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="核心源码" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
// https://github.com/MetaMask/metamask-inpage-provider/blob/master/index.js
const pump = require('pump')
const RpcEngine = require('json-rpc-engine')
const createIdRemapMiddleware = require('json-rpc-engine/src/idRemapMiddleware')
const createJsonRpcStream = require('json-rpc-middleware-stream')
const ObservableStore = require('obs-store')
const asStream = require('obs-store/lib/asStream')
const ObjectMultiplex = require('obj-multiplex')
const { inherits } = require('util')
const SafeEventEmitter = require('safe-event-emitter')
const dequal = require('fast-deep-equal')
const { ethErrors } = require('eth-json-rpc-errors')
const log = require('loglevel')

const messages = require('./src/messages')
const { sendSiteMetadata } = require('./src/siteMetadata')
const {
  createErrorMiddleware,
  logStreamDisconnectWarning,
  makeThenable,
} = require('./src/utils')

// resolve response.result, reject errors
const getRpcPromiseCallback = (resolve, reject) => (error, response) => {
  error || response.error
    ? reject(error || response.error)
    : Array.isArray(response)
      ? resolve(response)
      : resolve(response.result)
}

module.exports = MetamaskInpageProvider

inherits(MetamaskInpageProvider, SafeEventEmitter)

function MetamaskInpageProvider (connectionStream) {

  // super constructor
  SafeEventEmitter.call(this)

  // private state, kept here in part for use in the _metamask proxy
  this._state = {
    sentWarnings: {
      enable: false,
      experimentalMethods: false,
      isConnected: false,
      sendAsync: false,
      // TODO:deprecate:2020-Q1
      autoReload: false,
      sendSync: false,
    },
    isConnected: undefined,
    accounts: undefined,
    isUnlocked: undefined,
  }

  this._metamask = getExperimentalApi(this)

  // public state
  this.selectedAddress = null
  this.networkVersion = undefined
  this.chainId = undefined

  // setup connectionStream multiplexing
  const mux = this.mux = new ObjectMultiplex()
  pump(
    connectionStream,
    mux,
    connectionStream,
    this._handleDisconnect.bind(this, 'MetaMask'),
  )

  // subscribe to metamask public config (one-way)
  this._publicConfigStore = new ObservableStore({ storageKey: 'MetaMask-Config' })

  // handle isUnlocked changes, and chainChanged and networkChanged events
  this._publicConfigStore.subscribe(state => {

    if ('isUnlocked' in state && state.isUnlocked !== this._state.isUnlocked) {
      this._state.isUnlocked = state.isUnlocked
      this.emit('wallet_isUnlocked', this._state.isUnlocked)
      if (!this._state.isUnlocked) {
        // accounts are never exposed when the extension is locked
        this._handleAccountsChanged([])
      } else {
        // this will get the exposed accounts, if any
        try {
          this._sendAsync(
            { method: 'eth_accounts', params: [] },
            () => {},
          )
        } catch (_) {}
      }
    }

    // Emit chainChanged event on chain change
    if ('chainId' in state && state.chainId !== this.chainId) {
      this.chainId = state.chainId
      this.emit('chainChanged', this.chainId)
      this.emit('chainIdChanged', this.chainId) // TODO:deprecate:2020-Q1
    }

    // Emit networkChanged event on network change
    if ('networkVersion' in state && state.networkVersion !== this.networkVersion) {
      this.networkVersion = state.networkVersion
      this.emit('networkChanged', this.networkVersion)
    }
  })

  pump(
    mux.createStream('publicConfig'),
    asStream(this._publicConfigStore),
    // RPC requests should still work if only this stream fails
    logStreamDisconnectWarning.bind(this, 'MetaMask PublicConfigStore'),
  )

  // ignore phishing warning message (handled elsewhere)
  mux.ignoreStream('phishing')

  // setup own event listeners

  // EIP-1193 connect
  this.on('connect', () => {
    this._state.isConnected = true
  })

  // connect to async provider

  const jsonRpcConnection = createJsonRpcStream()
  pump(
    jsonRpcConnection.stream,
    mux.createStream('provider'),
    jsonRpcConnection.stream,
    this._handleDisconnect.bind(this, 'MetaMask RpcProvider'),
  )

  // handle RPC requests via dapp-side rpc engine
  const rpcEngine = new RpcEngine()
  rpcEngine.push(createIdRemapMiddleware())
  rpcEngine.push(createErrorMiddleware())
  rpcEngine.push(jsonRpcConnection.middleware)
  this._rpcEngine = rpcEngine

  // json rpc notification listener
  jsonRpcConnection.events.on('notification', payload => {
    if (payload.method === 'wallet_accountsChanged') {
      this._handleAccountsChanged(payload.result)
    } else if (payload.method === 'eth_subscription') {
      // EIP 1193 subscriptions, per eth-json-rpc-filters/subscriptionManager
      this.emit('notification', payload.params.result)
    }
  })

  // send website metadata
  const domContentLoadedHandler = () => {
    sendSiteMetadata(this._rpcEngine)
    window.removeEventListener('DOMContentLoaded', domContentLoadedHandler)
  }
  window.addEventListener('DOMContentLoaded', domContentLoadedHandler)

  // indicate that we've connected, for EIP-1193 compliance
  setTimeout(() => this.emit('connect'))

  // TODO:deprecate:2020-Q1
  // wait a second to attempt to send this, so that the warning can be silenced
  // moved this here because there's another warning in .enable() discouraging
  // the use thereof per EIP 1102
  setTimeout(() => {
    if (this.autoRefreshOnNetworkChange && !this._state.sentWarnings.autoReload) {
      log.warn(messages.warnings.autoReloadDeprecation)
      this._state.sentWarnings.autoReload = true
    }
  }, 1000)
}

// TODO:deprecate:2020-Q1
MetamaskInpageProvider.prototype._web3Ref = undefined

// TODO:deprecate:2020-Q1
// give the dapps control of a refresh they can toggle this off on the window.ethereum
// this will be default true so it does not break any old apps.
MetamaskInpageProvider.prototype.autoRefreshOnNetworkChange = true

MetamaskInpageProvider.prototype.isMetaMask = true

/**
 * Deprecated.
 * Returns whether the inpage provider is connected to MetaMask.
 */
MetamaskInpageProvider.prototype.isConnected = function () {

  if (!this._state.sentWarnings.isConnected) {
    log.warn(messages.warnings.isConnectedDeprecation)
    this._state.sentWarnings.isConnected = true
  }
  return this._state.isConnected
}

/**
 * Sends an RPC request to MetaMask. Resolves to the result of the method call.
 * May reject with an error that must be caught by the caller.
 *
 * @param {(string|Object)} methodOrPayload - The method name, or the RPC request object.
 * @param {Array<any>} [params] - If given a method name, the method's parameters.
 * @returns {Promise<any>} - A promise resolving to the result of the method call.
 */
MetamaskInpageProvider.prototype.send = function (methodOrPayload, params) {

  // preserve original params for later error if necessary
  const _params = params

  // construct payload object
  let payload
  if (
    typeof methodOrPayload === 'object' &&
    !Array.isArray(methodOrPayload)
  ) {

    // TODO:deprecate:2020-Q1
    // handle send(object, callback), an alias for sendAsync(object, callback)
    if (typeof params === 'function') {
      return this._sendAsync(methodOrPayload, params)
    }

    payload = methodOrPayload

    // TODO:deprecate:2020-Q1
    // backwards compatibility: "synchronous" methods
    if (!params && [
      'eth_accounts',
      'eth_coinbase',
      'eth_uninstallFilter',
      'net_version',
    ].includes(payload.method)) {
      return this._sendSync(payload)
    }
  } else if (
    typeof methodOrPayload === 'string' &&
    typeof params !== 'function'
  ) {

    // wrap params in array out of kindness
    if (params === undefined) {
      params = []
    } else if (!Array.isArray(params)) {
      params = [params]
    }

    payload = {
      method: methodOrPayload,
      params,
    }
  }

  // typecheck payload and payload.method
  if (
    Array.isArray(payload) ||
    typeof params === 'function' ||
    typeof payload !== 'object' ||
    typeof payload.method !== 'string'
  ) {
    throw ethErrors.rpc.invalidRequest({
      message: messages.errors.invalidParams(),
      data: [methodOrPayload, _params],
    })
  }

  return new Promise((resolve, reject) => {
    try {
      this._sendAsync(
        payload,
        getRpcPromiseCallback(resolve, reject),
      )
    } catch (error) {
      reject(error)
    }
  })
}

/**
 * Deprecated.
 * Equivalent to: ethereum.send('eth_requestAccounts')
 *
 * @returns {Promise<Array<string>>} - A promise that resolves to an array of addresses.
 */
MetamaskInpageProvider.prototype.enable = function () {

  if (!this._state.sentWarnings.enable) {
    log.warn(messages.warnings.enableDeprecation)
    this._state.sentWarnings.enable = true
  }
  return new Promise((resolve, reject) => {
    try {
      this._sendAsync(
        { method: 'eth_requestAccounts', params: [] },
        getRpcPromiseCallback(resolve, reject),
      )
    } catch (error) {
      reject(error)
    }
  })
}

/**
 * Deprecated.
 * Backwards compatibility. ethereum.send() with callback.
 *
 * @param {Object} payload - The RPC request object.
 * @param {Function} callback - The callback function.
 */
MetamaskInpageProvider.prototype.sendAsync = function (payload, cb) {

  if (!this._state.sentWarnings.sendAsync) {
    log.warn(messages.warnings.sendAsyncDeprecation)
    this._state.sentWarnings.sendAsync = true
  }
  this._sendAsync(payload, cb)
}

/**
 * TODO:deprecate:2020-Q1
 * Internal backwards compatibility method.
 */
MetamaskInpageProvider.prototype._sendSync = function (payload) {

  if (!this._state.sentWarnings.sendSync) {
    log.warn(messages.warnings.sendSyncDeprecation)
    this._state.sentWarnings.sendSync = true
  }

  let result
  switch (payload.method) {

    case 'eth_accounts':
      result = this.selectedAddress ? [this.selectedAddress] : []
      break

    case 'eth_coinbase':
      result = this.selectedAddress || null
      break

    case 'eth_uninstallFilter':
      this._sendAsync(payload, () => {})
      result = true
      break

    case 'net_version':
      result = this.networkVersion || null
      break

    default:
      throw new Error(messages.errors.unsupportedSync(payload.method))
  }

  // looks like a plain object, but behaves like a Promise if someone calls .then on it :evil_laugh:
  return makeThenable({
    id: payload.id,
    jsonrpc: payload.jsonrpc,
    result,
  }, 'result')
}

/**
 * Internal RPC method. Forwards requests to background via the RPC engine.
 * Also remap ids inbound and outbound.
 */
MetamaskInpageProvider.prototype._sendAsync = function (payload, userCallback) {

  let cb = userCallback

  if (!Array.isArray(payload)) {

    if (!payload.jsonrpc) {
      payload.jsonrpc = '2.0'
    }

    if (
      payload.method === 'eth_accounts' ||
      payload.method === 'eth_requestAccounts'
    ) {

      // handle accounts changing
      cb = (err, res) => {
        this._handleAccountsChanged(
          res.result || [],
          payload.method === 'eth_accounts',
        )
        userCallback(err, res)
      }
    }
  }

  this._rpcEngine.handle(payload, cb)
}

/**
 * Called when connection is lost to critical streams.
 */
MetamaskInpageProvider.prototype._handleDisconnect = function (streamName, err) {

  logStreamDisconnectWarning.bind(this)(streamName, err)
  if (this._state.isConnected) {
    this.emit('close', {
      code: 1011,
      reason: 'MetaMask background communication error.',
    })
  }
  this._state.isConnected = false
}

/**
 * Called when accounts may have changed.
 */
MetamaskInpageProvider.prototype._handleAccountsChanged = function (accounts, isEthAccounts = false) {

  // defensive programming
  if (!Array.isArray(accounts)) {
    log.error(
      'MetaMask: Received non-array accounts parameter. Please report this bug.',
      accounts,
    )
    accounts = []
  }

  // emit accountsChanged if anything about the accounts array has changed
  if (!dequal(this._state.accounts, accounts)) {

    // we should always have the correct accounts even before eth_accounts
    // returns, except if the method is called before we're fully initialized
    if (isEthAccounts && this._state.accounts !== undefined) {
      log.warn(
        `MetaMask: 'eth_accounts' updated accounts. Please report this bug.`,
        accounts,
      )
    }

    this.emit('accountsChanged', accounts)
    this._state.accounts = accounts
  }

  // handle selectedAddress
  if (this.selectedAddress !== accounts[0]) {
    this.selectedAddress = accounts[0] || null
  }

  // TODO:deprecate:2020-Q1
  // handle web3
  if (this._web3Ref) {
    this._web3Ref.defaultAccount = this.selectedAddress
  } else if (window.web3 && typeof window.web3.eth === 'object') {
    window.web3.eth.defaultAccount = this.selectedAddress
  }
}

/**
 * Gets experimental _metamask API as Proxy.
 */
function getExperimentalApi (instance) {
  return new Proxy(
    {

      /**
       * Determines if MetaMask is unlocked by the user.
       *
       * @returns {Promise<boolean>} - Promise resolving to true if MetaMask is currently unlocked
       */
      isUnlocked: async () => {
        if (instance._state.isUnlocked === undefined) {
          await new Promise(
            (resolve) => instance._publicConfigStore.once('update', () => resolve()),
          )
        }
        return instance._state.isUnlocked
      },

      /**
       * Make a batch request.
       */
      sendBatch: async (requests) => {

        // basic input validation
        if (!Array.isArray(requests)) {
          throw ethErrors.rpc.invalidRequest({
            message: 'Batch requests must be made with an array of request objects.',
            data: requests,
          })
        }

        return new Promise((resolve, reject) => {
          try {
            instance._sendAsync(
              requests,
              getRpcPromiseCallback(resolve, reject),
            )
          } catch (error) {
            reject(error)
          }
        })
      },

      // TODO:deprecate:2020-Q1 isEnabled, isApproved
      /**
       * Deprecated. Will be removed in Q1 2020.
       * Synchronously determines if this domain is currently enabled, with a potential false negative if called to soon
       *
       * @returns {boolean} - returns true if this domain is currently enabled
       */
      isEnabled: () => {
        return Array.isArray(instance._state.accounts) && instance._state.accounts.length > 0
      },

      /**
       * Deprecated. Will be removed in Q1 2020.
       * Asynchronously determines if this domain is currently enabled
       *
       * @returns {Promise<boolean>} - Promise resolving to true if this domain is currently enabled
       */
      isApproved: async () => {
        if (instance._state.accounts === undefined) {
          await new Promise(
            (resolve) => instance.once('accountsChanged', () => resolve()),
          )
        }
        return Array.isArray(instance._state.accounts) && instance._state.accounts.length > 0
      },
    },
    {

      get: (obj, prop) => {

        if (!instance._state.sentWarnings.experimentalMethods) {
          log.warn(messages.warnings.experimentalMethods)
          instance._state.sentWarnings.experimentalMethods = true
        }
        return obj[prop]
      },
    },
  )
}
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>



  <c:entry style="margin-top:1em;">
    <c:title id="nonce-tracker"><![CDATA[<div style="color:blue;font-size:1.625em;">nonce-tracker</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  How metamask calculates nonces
</div>
<div style="margin-bottom:.425em;font-size:1.425em;">
  https://github.com/MetaMask/nonce-tracker
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="使用" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
const NonceTracker = require('nonce-tracker')

const nonceTracker = new NonceTracker(config)

nonceLock = nonceTracker.getNonceLock('0xselectedEthereumAddress')

nonce = nonceLock.nextNonce
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  主要是得到 address 账户下一个交易的 nonce 值，核心就是下面三个值取最大的：
</div>
<ul style="margin-bottom:.425em;margin-top:.325em;list-style: disc;margin-left: 1.5em;font-size:1.225em;">
      <li>_getNetworkNextNonce(address)</li>
      <li>_getHighestLocallyConfirmed(address)</li>
      <li>localNonceResult.nonce</li>
    </ul>
<div style="margin-bottom:.425em;font-size:1.225em;">
  因为取值过程中涉及到 nonce++，所以使用了 await-semaphore 控制，防止多次执行。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="await-semaphore" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.825em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  信号量控制实现，主要是为了保护共享资源，使得资源在一个时刻只有一个进程（线程）所拥有。
</div>
<div style="margin-bottom:.425em;font-size:1.225em;">
使用 Seamphore，创建了多少线程，实际就会有多少线程进行执行，只是可同时执行的线程数量会受到限制。但使用线程池，不管你创建多少线程，实际可执行的线程数是一定的。
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
var semaphore = new Semaphore(10);

async function niceFetch(url) {
    var release = await semaphore.acquire();
    var result = await fetch(url);
    release();
    return result;
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="核心代码" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
const EthQuery = require('ethjs-query')
const assert = require('assert')
const Mutex = require('await-semaphore').Mutex
/**
  @param opts {Object}
    @param {Object} opts.provider a ethereum provider
    @param {Function} opts.getPendingTransactions a function that returns an array of txMeta
    whosee status is `submitted`
    @param {Function} opts.getConfirmedTransactions a function that returns an array of txMeta
    whose status is `confirmed`
  @class
*/
class NonceTracker {

  constructor ({ provider, blockTracker, getPendingTransactions, getConfirmedTransactions }) {
    this.provider = provider
    this.blockTracker = blockTracker
    this.ethQuery = new EthQuery(provider)
    this.getPendingTransactions = getPendingTransactions
    this.getConfirmedTransactions = getConfirmedTransactions
    this.lockMap = {}
  }

  /**
    @returns {Promise<Object>} with the key releaseLock (the gloabl mutex)
  */
  async getGlobalLock () {
    const globalMutex = this._lookupMutex('global')
    // await global mutex free
    const releaseLock = await globalMutex.acquire()
    return { releaseLock }
  }

  /**
   * @typedef NonceDetails
   * @property {number} highestLocallyConfirmed - A hex string of the highest nonce on a confirmed transaction.
   * @property {number} nextNetworkNonce - The next nonce suggested by the eth_getTransactionCount method.
   * @property {number} highestSuggested - The maximum between the other two, the number returned.
   */

  /**
  this will return an object with the `nextNonce` `nonceDetails`, and the releaseLock
  Note: releaseLock must be called after adding a signed tx to pending transactions (or discarding).

  @param address {string} the hex string for the address whose nonce we are calculating
  @returns {Promise<NonceDetails>}
  */
  async getNonceLock (address) {
    // await global mutex free
    await this._globalMutexFree()
    // await lock free, then take lock
    const releaseLock = await this._takeMutex(address)
    try {
      // evaluate multiple nextNonce strategies
      const nonceDetails = {}
      const networkNonceResult = await this._getNetworkNextNonce(address)
      const highestLocallyConfirmed = this._getHighestLocallyConfirmed(address)
      const nextNetworkNonce = networkNonceResult.nonce
      const highestSuggested = Math.max(nextNetworkNonce, highestLocallyConfirmed)

      const pendingTxs = this.getPendingTransactions(address)
      const localNonceResult = this._getHighestContinuousFrom(pendingTxs, highestSuggested) || 0

      nonceDetails.params = {
        highestLocallyConfirmed,
        highestSuggested,
        nextNetworkNonce,
      }
      nonceDetails.local = localNonceResult
      nonceDetails.network = networkNonceResult

      const nextNonce = Math.max(networkNonceResult.nonce, localNonceResult.nonce)
      assert(Number.isInteger(nextNonce), `nonce-tracker - nextNonce is not an integer - got: (${typeof nextNonce}) "${nextNonce}"`)

      // return nonce and release cb
      return { nextNonce, nonceDetails, releaseLock }
    } catch (err) {
      // release lock if we encounter an error
      releaseLock()
      throw err
    }
  }

  async _globalMutexFree () {
    const globalMutex = this._lookupMutex('global')
    const releaseLock = await globalMutex.acquire()
    releaseLock()
  }

  async _takeMutex (lockId) {
    const mutex = this._lookupMutex(lockId)
    const releaseLock = await mutex.acquire()
    return releaseLock
  }

  _lookupMutex (lockId) {
    let mutex = this.lockMap[lockId]
    if (!mutex) {
      mutex = new Mutex()
      this.lockMap[lockId] = mutex
    }
    return mutex
  }

  async _getNetworkNextNonce (address) {
    // calculate next nonce
    // we need to make sure our base count
    // and pending count are from the same block
    const blockNumber = await this.blockTracker.getLatestBlock()
    const baseCountBN = await this.ethQuery.getTransactionCount(address, blockNumber)
    const baseCount = baseCountBN.toNumber()
    assert(Number.isInteger(baseCount), `nonce-tracker - baseCount is not an integer - got: (${typeof baseCount}) "${baseCount}"`)
    const nonceDetails = { blockNumber, baseCount }
    return { name: 'network', nonce: baseCount, details: nonceDetails }
  }

  _getHighestLocallyConfirmed (address) {
    const confirmedTransactions = this.getConfirmedTransactions(address)
    const highest = this._getHighestNonce(confirmedTransactions)
    return Number.isInteger(highest) ? highest + 1 : 0
  }

  _getHighestNonce (txList) {
    const nonces = txList.map((txMeta) => {
      const nonce = txMeta.txParams.nonce
      assert(typeof nonce, 'string', 'nonces should be hex strings')
      return parseInt(nonce, 16)
    })
    const highestNonce = Math.max.apply(null, nonces)
    return highestNonce
  }

  /**
    @typedef {object} highestContinuousFrom
    @property {string} - name the name for how the nonce was calculated based on the data used
    @property {number} - nonce the next suggested nonce
    @property {object} - details the provided starting nonce that was used (for debugging)
  */
  /**
    @param txList {array} - list of txMeta's
    @param startPoint {number} - the highest known locally confirmed nonce
    @returns {highestContinuousFrom}
  */
  _getHighestContinuousFrom (txList, startPoint) {
    const nonces = txList.map((txMeta) => {
      const nonce = txMeta.txParams.nonce
      assert(typeof nonce, 'string', 'nonces should be hex strings')
      return parseInt(nonce, 16)
    })

    let highest = startPoint
    while (nonces.includes(highest)) {
      highest++
    }

    return { name: 'local', nonce: highest, details: { startPoint, highest } }
  }

}

module.exports = NonceTracker
   ]]>
    </c:sourceContent>

    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>




  <c:entry style="margin-top:1em;">
    <c:title id="obs-store"><![CDATA[<div style="color:blue;font-size:1.625em;">obs-store</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  ObservableStore is a synchronous in-memory store for a single value, that you can subscribe to updates on.
</div>
<div style="margin-bottom:.425em;font-size:1.425em;">
  https://github.com/MetaMask/obs-store
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
const store = new ObservableStore(initState)
store.subscribe(function showValue(value) {
  console.log('saw value:', value)
})

store.putState(5) // "saw value: 5"
store.putState(true) // "saw value: true"
store.putState({ hello: 'world' }) // "saw value: { hello: 'world' }"

console.log(store.getState().hello) // "world"
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="streams" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  Each ObservableStore can be turned into an ObservableStoreStream. An ObservableStoreStream is a duplex stream that you can pipe new values into it or pipe its updated values out of it
</div>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.825em;font-family:monospace;margin-top:1em;">
      <![CDATA[
// Special behavior: Doesnt buffer outgoing updates, writes latest state to dest on pipe.
const pipe = require('pump')
const asStream = require('obs-store/lib/asStream')

const storeOne = new ObservableStore(initState)
const storeTwo = new ObservableStore()

pipe(
  asStream(storeOne),
  transformStream,
  asStream(storeTwo)
)
   ]]>
    </c:sourceContent>
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>



  <c:entry style="margin-top:1em;">
    <c:title id="post-message-stream"><![CDATA[<div style="color:blue;font-size:1.625em;">post-message-stream</div>]]></c:title>
    <c:desc>
      <c:desc1> <![CDATA[
<div style="margin-bottom:.425em;font-size:1.225em;">
  Sets up a duplex object stream over window.postMessage
</div>
<div style="margin-bottom:.425em;font-size:1.425em;">
  https://github.com/kumavis/post-message-stream
</div>
]]></c:desc1>
    </c:desc>
    <c:sourceContent type="" title="" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
var streamA = new PostMessageStream({
  name: 'thing one',
  target: 'thing two',
})

var streamB = new PostMessageStream({
  name: 'thing two',
  target: 'thing one',
})

streamB.on('data', (data) => console.log(data))
streamA.write(chunk)
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="constructor arguments" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.625em;font-family:monospace;">
      <![CDATA[
var messageStream = new PostMessageStream({

  // required

  // name of stream, used to differentiate
  // when multiple streams are on the same window 
  name: 'source',

  // name of target stream 
  target: 'sink',

  // optional

  // window to send the message to
  // default is `window`
  window: iframe.contentWindow,
  
})
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="window.postMessage" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.825em;font-family:monospace;">
      <![CDATA[
// https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage
// window.postMessage() 方法可以安全地实现跨源通信。

// otherWindow 其他窗口的一个引用
// message 将要发送到其他 window的数据
// targetOrigin 通过窗口的origin属性来指定哪些窗口能接收到消息事件
                其值可以是字符串"*"（表示无限制）或者一个URI。
// transfer 是一串和message 同时传递的 Transferable 对象
otherWindow.postMessage(message, targetOrigin, [transfer]);

// 执行如下代码, 其他window可以监听分发的message:
window.addEventListener("message", receiveMessage, false);

// event
// data 从其他 window 中传递过来的对象
// origin 调用 postMessage  时消息发送方窗口的 origin
// source 对发送消息的窗口对象的引用
function receiveMessage(event) {
  var origin = event.origin || event.originalEvent.origin; 
  if (origin !== "http://example.org:8080")
    return;

  // ...
}
   ]]>
    </c:sourceContent>
    <c:sourceContent type="html" title="" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.825em;font-family:monospace;margin-top:1em;">
      <![CDATA[
<ul style="margin-top:.325em;list-style: disc;margin-left: 1.5em;">
  <li>如果您不希望从其他网站接收 message，请不要为 message 事件添加任何事件侦听器。 </li>
  <li>如果您确实希望从其他网站接收 message，请始终使用 origin 和 source 属性验证发件人的身份。</li>
  <li>当您使用 postMessage 将数据发送到其他窗口时，始终指定精确的目标 origin，而不是*。</li>
</ul>
   ]]>
    </c:sourceContent>
    <c:sourceContent type="" title="核心源码" id="sourceContent1"
                     titleStyle="padding-left:0;padding-bottom: 0;color:green;font-size:1em;background-color:white;font-size:1.2em;margin-top:1em;"
                     bodyStyle="background-color:white;padding:0;font-size:1em;line-height:1.825em;font-family:monospace;">
      <![CDATA[
// https://github.com/kumavis/post-message-stream/blob/master/index.js
const DuplexStream = require('readable-stream').Duplex
const inherits = require('util').inherits

module.exports = PostMessageStream

inherits(PostMessageStream, DuplexStream)

function PostMessageStream (opts) {
  DuplexStream.call(this, {
    objectMode: true,
  })

  this._name = opts.name
  this._target = opts.target
  this._targetWindow = opts.targetWindow || window
  this._origin = (opts.targetWindow ? '*' : location.origin)

  // initialization flags
  this._init = false
  this._haveSyn = false

  window.addEventListener('message', this._onMessage.bind(this), false)
  // send syncorization message
  this._write('SYN', null, noop)
  // 调用 writable.cork() 方法将强制所有写入数据都内存中的缓冲区里。
  // 直到调用 stream.uncork() 或 stream.end() 方法时，缓冲区里的数据才会被输出。
  this.cork()
}

// private
PostMessageStream.prototype._onMessage = function (event) {
  var msg = event.data

  // validate message
  if (this._origin !== '*' && event.origin !== this._origin) return
  if (event.source !== this._targetWindow) return
  if (typeof msg !== 'object') return
  if (msg.target !== this._name) return
  if (!msg.data) return

  if (!this._init) {
    // listen for handshake 模拟三次握手，再消费消息
    if (msg.data === 'SYN') {
      this._haveSyn = true
      this._write('ACK', null, noop)
    } else if (msg.data === 'ACK') {
      this._init = true
      if (!this._haveSyn) {
        this._write('ACK', null, noop)
      }
      // writable.uncork() 将输出在 stream.cork() 方法被调用之后缓冲在内存中的所有数据。
      // 如果一个流多次调用了 writable.cork() 方法，
      //   那么也必须调用同样次数的 writable.uncork() 方法以输出缓冲区数据。
      this.uncork()
    }
  } else {
    // forward message
    try {
      this.push(msg.data)
    } catch (err) {
      this.emit('error', err)
    }
  }
}

// stream plumbing
PostMessageStream.prototype._read = noop

PostMessageStream.prototype._write = function (data, encoding, cb) {
  var message = {
    target: this._target,
    data: data,
  }
  this._targetWindow.postMessage(message, this._origin)
  cb()
}

// util

function noop () {}
   ]]>
    </c:sourceContent>
    <c:comment>
      <c:comment1>
        <![CDATA[]]>
      </c:comment1>
    </c:comment>
  </c:entry>

</c:component>
